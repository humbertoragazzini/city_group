"use client";
import { useEffect, useState, useRef } from "react";
import Ring from "../Mesh/Ring";
import Sphere from "../Mesh/Sphere";
import { usePathname } from "next/navigation";
import { useThree } from "@react-three/fiber";
import gsap from "gsap";
import PlaneBG from "../Mesh/PlaneBG";
import Logo from "../Mesh/Logo/Logo";
import { Float } from "@react-three/drei";

export default function MainBGAnimation({ scrollPosition }: any) {
  const pathname = usePathname();
  const three = useThree();
  const [positions, setPositions] = useState<any>([
    {
      position: [3.6573975376442363, 17.318575046851173, 13.419769710573547],
      scale: 1.054941813768597,
    },
    {
      position: [-0.34736561936976784, -9.605681861921623, -11.747618431879662],
      scale: 0.2936064255445333,
    },
    {
      position: [-9.723538935486808, -19.37088543967902, -10.350623279393869],
      scale: 1.0045221648742069,
    },
    {
      position: [-8.826301562796413, 9.976760281892751, -11.555844540119576],
      scale: 0.5944632185857527,
    },
    {
      position: [-3.439838624093195, -1.6071448158456185, -27.871139993638018],
      scale: 0.9062273289407042,
    },
    {
      position: [0.801740044008092, -0.610411538202893, -10.097438523787563],
      scale: 0.1345055290671943,
    },
    {
      position: [-15.321872380932678, 19.163626374659735, -18.218857495331466],
      scale: 0.2800472947219802,
    },
    {
      position: [-3.8721047281455867, 16.986776220615795, 11.188290945394407],
      scale: 0.6996955849418075,
    },
    {
      position: [11.367002590341258, -17.17937384428243, 13.183675961202368],
      scale: 0.8715367074132644,
    },
    {
      position: [12.641904083436927, -24.219110777858543, -24.779538124076332],
      scale: 0.8341801399793282,
    },
    {
      position: [-12.744851565643856, 1.9102336088568599, 2.3479070200250405],
      scale: 0.8021417040745901,
    },
    {
      position: [
        -10.473506574297042, -13.082440572912324, -0.10700719059443742,
      ],
      scale: 0.9466038621344478,
    },
    {
      position: [-2.2193804578916065, -14.328049235562112, -9.830771915993388],
      scale: 0.5733498052506828,
    },
    {
      position: [20.69674176754502, 17.657388955826413, -12.001623662345597],
      scale: 0.5821012975091423,
    },
    {
      position: [10.096936671492948, 14.51875791883208, -5.849132988506234],
      scale: 0.19964224237406483,
    },
    {
      position: [16.82155680189277, 15.562139119437425, -28.759894219804252],
      scale: 0.7569992262660615,
    },
    {
      position: [-10.666070496935198, -17.33742708645778, -7.648041931762986],
      scale: 0.1271554992892995,
    },
    {
      position: [10.26541207695255, -4.125745654560763, 12.7059016511826],
      scale: 0.4867887312206015,
    },
    {
      position: [1.0412434617045108, 3.246651938454658, -7.879942528247742],
      scale: 0.9562490071966862,
    },
    {
      position: [-15.651661302432506, 4.35312924278406, -9.275551873015424],
      scale: 0.4623051971767037,
    },
    {
      position: [21.16778361390933, 9.79320979831514, -34.443809021976],
      scale: 0.7575616289224519,
    },
    {
      position: [3.114906497935454, -9.237725915449236, -21.46557568476392],
      scale: 0.20267527900134943,
    },
    {
      position: [-23.219144361008226, 1.5519454596208178, -0.2801856588060545],
      scale: 0.7996613325994836,
    },
    {
      position: [9.587237232553512, -10.270920277968386, -22.556911870112476],
      scale: 0.5978003843536784,
    },
    {
      position: [-20.721907877741607, 9.195919734613867, -9.675195027180052],
      scale: 1.0212855841136748,
    },
    {
      position: [-1.6167970969382495, -3.116270787433429, 12.583728751064235],
      scale: 0.6131979798245178,
    },
    {
      position: [16.19728009513343, -19.543115730822326, -8.328386210683107],
      scale: 0.6454657115194912,
    },
    {
      position: [-6.422662879443873, 17.651353289988023, -13.401989214134503],
      scale: 0.2810503886780372,
    },
    {
      position: [-5.408099815814772, 12.605552551195629, 12.96624373003825],
      scale: 0.48783143065617274,
    },
    {
      position: [-20.203991850608993, 10.595541591310266, -12.745396661324307],
      scale: 0.38368502739527466,
    },
    {
      position: [10.774273968497184, 3.202073805821758, 14.600040045048367],
      scale: 1.0436007990770313,
    },
    {
      position: [19.201142764943093, -15.422403840404986, -11.44554572471116],
      scale: 0.2778956950227155,
    },
    {
      position: [-24.74404638466875, 9.272719639079781, -20.47465283640725],
      scale: 0.7162723099494216,
    },
    {
      position: [-24.9416922804677, -3.3234160894365807, -24.642975579716577],
      scale: 0.23841008584544557,
    },
    {
      position: [17.134069791691466, -23.506457623067188, -19.232953175689786],
      scale: 0.11843456889909146,
    },
    {
      position: [-10.056761732301034, 3.273431141060577, -19.71786634780876],
      scale: 0.3528056016458826,
    },
    {
      position: [-23.898976100580093, 14.475993352784876, -19.64470205064889],
      scale: 0.4905503437988502,
    },
    {
      position: [-0.32256213837286296, -0.2561376070017616, -7.083392412635639],
      scale: 0.3397876651402659,
    },
    {
      position: [-24.64003110769255, -18.801305736900463, -29.071108098432866],
      scale: 0.40093619103128375,
    },
    {
      position: [3.390831125650486, 3.2759040934553525, -0.19740997665957138],
      scale: 0.6036616926229791,
    },
    {
      position: [24.497226038001806, 4.4262506616753114, -9.69009807513546],
      scale: 0.8875848912708596,
    },
    {
      position: [10.78009378476046, 9.549800678694965, -10.148925350323271],
      scale: 0.756968324941277,
    },
    {
      position: [21.069275804238806, -24.674000780578144, -4.570920203765809],
      scale: 0.5908587571432947,
    },
    {
      position: [-8.92296525920625, -11.920297112085109, -5.907333392463922],
      scale: 0.16965095349667494,
    },
    {
      position: [11.141583510357947, -3.495893186903043, -21.116245015773796],
      scale: 0.7483451668065838,
    },
    {
      position: [13.560957955989906, 10.220514388686993, -10.100320245280983],
      scale: 0.8158315918873257,
    },
    {
      position: [-22.93489759786721, -20.674223602171416, -15.913028189522706],
      scale: 0.8700645988991823,
    },
    {
      position: [-20.646704050006072, -16.87081108109988, 8.122499508853693],
      scale: 0.766650159848154,
    },
    {
      position: [-0.5167852073185699, 19.63540269313779, -32.37616103519255],
      scale: 0.5601071479837446,
    },
    {
      position: [10.646400846957427, -11.799663947634965, -29.185287299973975],
      scale: 0.1683376560086435,
    },
    {
      position: [9.644618557348693, -7.53483044805947, -23.78179897100963],
      scale: 0.9143429226045964,
    },
    {
      position: [13.823539020976405, -3.641883559169269, 12.25820036640932],
      scale: 1.0987875966846992,
    },
    {
      position: [5.456508557470741, -20.9638066742757, -31.04352947752043],
      scale: 0.4127763032654507,
    },
    {
      position: [-14.177739386392652, 6.816224676480708, -11.00433269207715],
      scale: 0.2607043937700514,
    },
    {
      position: [19.62153522696579, 22.712801918662976, -28.3954108058496],
      scale: 0.8747377298818108,
    },
    {
      position: [-22.852499335437937, 1.0113565196797865, 6.787531090162197],
      scale: 1.069100973360933,
    },
    {
      position: [-10.89933589369323, -2.74569699823941, -9.88660976890218],
      scale: 0.3583611099935732,
    },
    {
      position: [-19.95245978614052, 3.131685636991733, 8.604554762550492],
      scale: 0.22578079911853513,
    },
    {
      position: [-23.31557717042716, 17.324640004781166, 3.473994024458591],
      scale: 0.6877480326437296,
    },
    {
      position: [9.244591595676475, 2.2134443286172534, -25.508371111999054],
      scale: 0.5454225815286066,
    },
    {
      position: [-21.274649359122833, -7.958850439969346, -29.577644030336828],
      scale: 0.33495310913191056,
    },
    {
      position: [2.854262570580225, 22.975916545265477, -16.979643379211996],
      scale: 0.4698268021394295,
    },
    {
      position: [17.35223327268485, 22.584176245215673, 8.40925191565119],
      scale: 0.2747366810932782,
    },
    {
      position: [1.266890236681462, -0.18965434124929104, -34.07106166410383],
      scale: 0.7930328144414381,
    },
    {
      position: [-23.203862996393177, 5.690242746523332, -11.320423649445267],
      scale: 0.8698779994689029,
    },
    {
      position: [3.2417176550355933, 4.17968680336044, -12.691999269055888],
      scale: 0.16532745204008528,
    },
    {
      position: [16.01758658519399, 23.654863665657267, -32.79193326100679],
      scale: 0.823697110118634,
    },
    {
      position: [20.428414195996844, -13.65262797113691, -21.51050572240777],
      scale: 0.9089388894225648,
    },
    {
      position: [12.77260361822686, -12.199847194096957, -25.393419895196903],
      scale: 0.8820720333769053,
    },
    {
      position: [-19.516230963213598, 6.366344331784234, -5.337526981462485],
      scale: 1.0200984962176947,
    },
    {
      position: [3.200668640689365, 3.0129674804740922, -23.87362387089516],
      scale: 0.16595863758045928,
    },
    {
      position: [-13.385415315860794, -12.160578078014739, -22.59601550904711],
      scale: 1.0619217225597586,
    },
    {
      position: [18.483407096383132, -11.936137904496558, 12.502216311826139],
      scale: 0.8533132726818647,
    },
    {
      position: [-18.722194893982156, 23.435383499464493, 13.69821180005669],
      scale: 0.34670059184898927,
    },
    {
      position: [23.190877716115175, 18.946777234274904, 9.005405692188127],
      scale: 0.765631370994274,
    },
    {
      position: [4.262833046399539, 22.699848569577227, -15.338132259089111],
      scale: 0.8564147421713658,
    },
    {
      position: [8.692601178334833, -15.124504641000257, -20.182077674838297],
      scale: 0.7950255788386481,
    },
    {
      position: [-15.103584855120245, 24.954368311668972, 9.693125265902609],
      scale: 0.633322923718079,
    },
    {
      position: [-15.712359457709447, -5.89562638554635, 13.62313695907308],
      scale: 0.38328708726179583,
    },
    {
      position: [-6.383194905957058, -13.209161931799152, -3.866276824638117],
      scale: 0.3421148590953841,
    },
    {
      position: [24.777974005867897, 16.165044660526085, -2.0355430397553818],
      scale: 0.44989726295207666,
    },
    {
      position: [-7.939229369973145, -21.294147212819002, 10.68393035499588],
      scale: 0.7586855907598263,
    },
    {
      position: [-17.96094634895654, 22.005344300028526, -20.65832009067926],
      scale: 1.044068675252333,
    },
    {
      position: [13.698398434585421, 19.702621022081978, 0.9565115266971631],
      scale: 0.520294144363738,
    },
    {
      position: [9.708924105846549, -0.590926786923962, -31.737272339649206],
      scale: 0.23498991656326376,
    },
    {
      position: [12.877602629196872, -22.03941245219172, -22.578666550787887],
      scale: 0.9914317528126028,
    },
    {
      position: [-7.786153652839477, -5.060818990662284, -12.589420682327003],
      scale: 0.3862066598403108,
    },
    {
      position: [5.132348523618624, -5.895363493759643, -0.500060953083981],
      scale: 0.9530515203216255,
    },
    {
      position: [-24.638270637097836, 7.272631122921922, -4.73497723057277],
      scale: 0.7745584597167828,
    },
    {
      position: [12.356643008385419, 13.127445658526938, -0.6734953705214153],
      scale: 0.684580500813139,
    },
    {
      position: [-4.653280477496779, 13.084998550964485, -28.853773417714272],
      scale: 0.9227605513935809,
    },
    {
      position: [-14.480596788004796, 1.6563559122393592, 14.61536684199833],
      scale: 0.9324720899503666,
    },
    {
      position: [-9.368603531052589, -3.946633917506105, -24.275252512534998],
      scale: 0.6319879047105946,
    },
    {
      position: [20.67599951591582, 11.551997545053815, 11.266697303108792],
      scale: 0.8749219663734465,
    },
    {
      position: [-14.25624800949632, -21.780398330680395, -28.96480783765846],
      scale: 0.7317676261468135,
    },
    {
      position: [2.1921628254790946, -23.444622813486525, -30.97439411265278],
      scale: 0.5441360827466722,
    },
    {
      position: [18.68508057600115, -22.947905634112452, -9.201168930429539],
      scale: 0.6969036275718935,
    },
    {
      position: [4.6898634350539545, 21.73443398387439, -17.28469980029478],
      scale: 0.6970330104974479,
    },
    {
      position: [-2.455873784904526, 11.028165437024803, -22.696480986250858],
      scale: 1.013175864235568,
    },
    {
      position: [-11.612417644990991, -14.327659748476995, -11.482486485478386],
      scale: 0.9815030339806935,
    },
  ]);
  const { camera, size } = useThree();
  const cameraRef = useRef<any>(camera);
  const [useDistance, setUseDistance] = useState();

  // Function to update the camera's FOV based on window width
  const updateFOV = () => {
    let aspect = 0;
    let fov = 0;

    switch (pathname) {
      case "/":
        aspect = size.width / size.height;
        fov = 2 * Math.atan(25 / (2.5 * 8 * aspect)) * (180 / Math.PI);
        cameraRef.current.fov = fov;
        cameraRef.current.updateProjectionMatrix();
        break;
      case "/AboutUs":
        aspect = size.width / size.height;
        fov = 2 * Math.atan(25 / (2.5 * 8 * aspect)) * (180 / Math.PI);
        cameraRef.current.fov = fov;
        cameraRef.current.updateProjectionMatrix();
        break;
      case "/OurServices":
        aspect = size.width / size.height;
        fov = 2 * Math.atan(25 / (2.5 * 8 * aspect)) * (180 / Math.PI);
        cameraRef.current.fov = fov;
        cameraRef.current.updateProjectionMatrix();
        break;
      case "/ContactUs":
        aspect = size.width / size.height;
        fov = 2 * Math.atan(25 / (2.5 * 8 * aspect)) * (180 / Math.PI);
        cameraRef.current.fov = fov;
        cameraRef.current.updateProjectionMatrix();
        break;

      default:
        break;
    }
  };

  useEffect(() => {
    updateFOV();
    window.addEventListener("resize", updateFOV);
    return () => {
      window.removeEventListener("resize", updateFOV);
    };
  }, [size.width, size.height]);

  useEffect(() => {
    console.log("we change position");
    switch (pathname) {
      case "/":
        gsap.to(three.camera.position, { x: 0, z: 8, duration: 1.5 });
        break;
      case "/AboutUs":
        gsap.to(three.camera.position, { x: 4, z: 8, duration: 1.5 });
        break;
      case "/OurServices":
        gsap.to(three.camera.position, { x: -4, z: 8, duration: 1.5 });
        break;
      case "/ContactUs":
        gsap.to(three.camera.position, { x: 0, z: 8, duration: 1.5 });
        break;

      default:
        break;
    }
    // let positions = "";
    // for (let i = 0; i < 100; i++) {
    //   const scale = Math.random() + 0.1;
    //   const x = Math.random() * 50 - 25;
    //   const y = Math.random() * 50 - 25;
    //   const z = Math.random() * 50 - 35;
    //   positions += `{position:[${x},${y},${z}],scale:${scale}},`;
    //   console.log(positions);
    // }
  }, [pathname]); // eslint-disable-next-line react-hooks/exhaustive-deps

  useEffect(() => {
    console.log("position inside of animation", scrollPosition / 680);
    // three.camera.position.y = -scrollPosition / 1300;
    gsap.to(three.camera.position, { y: -scrollPosition / 680 });
  }, [scrollPosition]);

  return (
    <>
      {/* Light */}
      <ambientLight intensity={0.25}></ambientLight>
      <directionalLight
        position={[1, 1, 1]}
        intensity={5}
        castShadow
        shadow-mapSize-width={2048}
        shadow-mapSize-height={2048}
        shadow-camera-far={50}
        shadow-camera-left={-10}
        shadow-camera-right={10}
        shadow-camera-top={10}
        shadow-camera-bottom={-10}
        shadow-bias={-0.0005}
      ></directionalLight>
      {/* Meshes */}
      {/* <PlaneBG position={[0, 2, -1.5]} color={"#d1d1d1"} size={1000}></PlaneBG> */}
      {positions.map((obj: any) => {
        return (
          <>
            <Float>
              <Sphere position={obj.position} size={obj.scale}></Sphere>
            </Float>
          </>
        );
      })}
      <Sphere position={[3, 3, 30]} color={"red"} size={1}></Sphere>
      <Logo
        position={[-2.45, 0, 0]}
        rotationStart={[Math.PI / 2, -Math.PI / 2, Math.PI / 2]}
        rotationEnd={[Math.PI / 2, 0, Math.PI / 2]}
        checkPath={pathname}
        scale={1.5}
      ></Logo>
      <Logo
        position={[2.45, 0, 0]}
        rotationStart={[Math.PI / 2, -Math.PI / 2, Math.PI / 2]}
        rotationEnd={[Math.PI / 2, Math.PI, Math.PI / 2]}
        checkPath={pathname}
        scale={1.5}
      ></Logo>
    </>
  );
}
