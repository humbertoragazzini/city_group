"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[610],{4307:function(e,t,r){r.d(t,{j:function(){return u}});var i=r(2988),n=r(2265),a=r(7776),s=r(5238);let o={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},l={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},u=n.forwardRef(({scale:e=10,frames:t=1/0,opacity:r=1,width:u=1,height:c=1,blur:h=1,near:d=0,far:f=10,resolution:p=512,smooth:m=!0,color:v="#000000",depthWrite:g=!1,renderOrder:y,...w},b)=>{let _,x;let M=n.useRef(null),S=(0,s.A)(e=>e.scene),E=(0,s.A)(e=>e.gl),T=n.useRef(null);u*=Array.isArray(e)?e[0]:e||1,c*=Array.isArray(e)?e[1]:e||1;let[A,P,k,C,I,U,O]=n.useMemo(()=>{let e=new a.WebGLRenderTarget(p,p),t=new a.WebGLRenderTarget(p,p);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;let r=new a.PlaneGeometry(u,c).rotateX(Math.PI/2),i=new a.Mesh(r),n=new a.MeshDepthMaterial;n.depthTest=n.depthWrite=!1,n.onBeforeCompile=e=>{e.uniforms={...e.uniforms,ucolor:{value:new a.Color(v)}},e.fragmentShader=e.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};let s=new a.ShaderMaterial(o),h=new a.ShaderMaterial(l);return h.depthTest=s.depthTest=!1,[e,r,n,i,s,h,t]},[p,u,c,e,v]),R=e=>{C.visible=!0,C.material=I,I.uniforms.tDiffuse.value=A.texture,I.uniforms.h.value=1*e/256,E.setRenderTarget(O),E.render(C,T.current),C.material=U,U.uniforms.tDiffuse.value=O.texture,U.uniforms.v.value=1*e/256,E.setRenderTarget(A),E.render(C,T.current),C.visible=!1},D=0;return(0,s.C)(()=>{T.current&&(t===1/0||D<t)&&(D++,_=S.background,x=S.overrideMaterial,M.current.visible=!1,S.background=null,S.overrideMaterial=k,E.setRenderTarget(A),E.render(S,T.current),R(h),m&&R(.4*h),E.setRenderTarget(null),M.current.visible=!0,S.overrideMaterial=x,S.background=_)}),n.useImperativeHandle(b,()=>M.current,[]),n.createElement("group",(0,i.Z)({"rotation-x":Math.PI/2},w,{ref:M}),n.createElement("mesh",{renderOrder:y,geometry:P,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},n.createElement("meshBasicMaterial",{transparent:!0,map:A.texture,opacity:r,depthWrite:g})),n.createElement("orthographicCamera",{ref:T,args:[-u/2,u/2,c/2,-c/2,d,f]}))})},7187:function(e,t,r){let i;r.d(t,{qA:function(){return eT}});var n=r(2988),a=r(2265),s=r(5238),o=r(7776);let l=e=>e&&e.isCubeTexture;class u extends o.Mesh{constructor(e,t){var r,i;let n=l(e),a=Math.floor(Math.log2((null!=(i=n?null==(r=e.image[0])?void 0:r.width:e.image.width)?i:1024)/4)),s=Math.pow(2,a),u=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,c=[n?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/(3*Math.max(s,112))}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*s)}`,`#define CUBEUV_MAX_MIP ${a}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(o.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `;super(new o.IcosahedronGeometry(1,16),new o.ShaderMaterial({uniforms:{map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}},fragmentShader:c,vertexShader:u,side:o.DoubleSide}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}class c extends o.DataTextureLoader{constructor(e){super(e),this.type=o.HalfFloatType}parse(e){let t,r,i;let n=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},a=function(e,t,r){t=t||1024;let i=e.pos,n=-1,a=0,s="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(n=o.indexOf("\n"))&&a<t&&i<e.byteLength;)s+=o,a+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return -1<n&&(!1!==r&&(e.pos+=a+n+1),s+o.slice(0,n))},s=new Uint8Array(e);s.pos=0;let l=function(e){let t,r;let i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=a(e))||n(1,"no header found"),(r=t.match(/^#\?(\S+)/))||n(3,"bad initial token"),u.valid|=1,u.programtype=r[1],u.string+=t+"\n";!1!==(t=a(e));){if(u.string+=t+"\n","#"===t.charAt(0)){u.comments+=t+"\n";continue}if((r=t.match(i))&&(u.gamma=parseFloat(r[1])),(r=t.match(s))&&(u.exposure=parseFloat(r[1])),(r=t.match(o))&&(u.valid|=2,u.format=r[1]),(r=t.match(l))&&(u.valid|=4,u.height=parseInt(r[1],10),u.width=parseInt(r[2],10)),2&u.valid&&4&u.valid)break}return 2&u.valid||n(3,"missing format specifier"),4&u.valid||n(3,"missing image size specifier"),u}(s),u=l.width,c=l.height,h=function(e,t,r){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&n(3,"wrong scanline width");let i=new Uint8Array(4*t*r);i.length||n(4,"unable to allocate buffer space");let a=0,s=0,o=4*t,l=new Uint8Array(4),u=new Uint8Array(o),c=r;for(;c>0&&s<e.byteLength;){s+4>e.byteLength&&n(1),l[0]=e[s++],l[1]=e[s++],l[2]=e[s++],l[3]=e[s++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&n(3,"bad rgbe scanline format");let r=0,h;for(;r<o&&s<e.byteLength;){let t=(h=e[s++])>128;if(t&&(h-=128),(0===h||r+h>o)&&n(3,"bad scanline data"),t){let t=e[s++];for(let e=0;e<h;e++)u[r++]=t}else u.set(e.subarray(s,s+h),r),r+=h,s+=h}for(let e=0;e<t;e++){let r=0;i[a]=u[e+r],r+=t,i[a+1]=u[e+r],r+=t,i[a+2]=u[e+r],r+=t,i[a+3]=u[e+r],a+=4}c--}return i}(s.subarray(s.pos),u,c);switch(this.type){case o.FloatType:let d=new Float32Array(4*(i=h.length/4));for(let e=0;e<i;e++)!function(e,t,r,i){let n=Math.pow(2,e[t+3]-128)/255;r[i+0]=e[t+0]*n,r[i+1]=e[t+1]*n,r[i+2]=e[t+2]*n,r[i+3]=1}(h,4*e,d,4*e);t=d,r=o.FloatType;break;case o.HalfFloatType:let f=new Uint16Array(4*(i=h.length/4));for(let e=0;e<i;e++)!function(e,t,r,i){let n=Math.pow(2,e[t+3]-128)/255;r[i+0]=o.DataUtils.toHalfFloat(Math.min(e[t+0]*n,65504)),r[i+1]=o.DataUtils.toHalfFloat(Math.min(e[t+1]*n,65504)),r[i+2]=o.DataUtils.toHalfFloat(Math.min(e[t+2]*n,65504)),r[i+3]=o.DataUtils.toHalfFloat(1)}(h,4*e,f,4*e);t=f,r=o.HalfFloatType;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:u,height:c,data:t,header:l.string,gamma:l.gamma,exposure:l.exposure,type:r}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,function(e,r){switch(e.type){case o.FloatType:case o.HalfFloatType:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=o.LinearFilter,e.magFilter=o.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,i)}}var h={},d=Uint8Array,f=Uint16Array,p=Uint32Array,m=new d([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),v=new d([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),g=new d([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),y=function(e,t){for(var r=new f(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];for(var n=new p(r[30]),i=1;i<30;++i)for(var a=r[i];a<r[i+1];++a)n[a]=a-r[i]<<5|i;return[r,n]},w=y(m,2),b=w[0],_=w[1];b[28]=258,_[258]=28;for(var x=y(v,0),M=x[0],S=x[1],E=new f(32768),T=0;T<32768;++T){var A=(43690&T)>>>1|(21845&T)<<1;A=(61680&(A=(52428&A)>>>2|(13107&A)<<2))>>>4|(3855&A)<<4,E[T]=((65280&A)>>>8|(255&A)<<8)>>>1}for(var P=function(e,t,r){for(var i,n=e.length,a=0,s=new f(t);a<n;++a)++s[e[a]-1];var o=new f(t);for(a=0;a<t;++a)o[a]=o[a-1]+s[a-1]<<1;if(r){i=new f(1<<t);var l=15-t;for(a=0;a<n;++a)if(e[a])for(var u=a<<4|e[a],c=t-e[a],h=o[e[a]-1]++<<c,d=h|(1<<c)-1;h<=d;++h)i[E[h]>>>l]=u}else for(a=0,i=new f(n);a<n;++a)e[a]&&(i[a]=E[o[e[a]-1]++]>>>15-e[a]);return i},k=new d(288),T=0;T<144;++T)k[T]=8;for(var T=144;T<256;++T)k[T]=9;for(var T=256;T<280;++T)k[T]=7;for(var T=280;T<288;++T)k[T]=8;for(var C=new d(32),T=0;T<32;++T)C[T]=5;var I=P(k,9,1),U=P(C,5,1),O=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},R=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},D=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},F=function(e){return(e/8|0)+(7&e&&1)},L=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var i=new(e instanceof f?f:e instanceof p?p:d)(r-t);return i.set(e.subarray(t,r)),i},V=function(e,t,r){var i=e.length;if(!i||r&&!r.l&&i<5)return t||new d(0);var n=!t||r,a=!r||r.i;r||(r={}),t||(t=new d(3*i));var s=function(e){var r=t.length;if(e>r){var i=new d(Math.max(2*r,e));i.set(t),t=i}},o=r.f||0,l=r.p||0,u=r.b||0,c=r.l,h=r.d,f=r.m,p=r.n,y=8*i;do{if(!c){r.f=o=R(e,l,1);var w=R(e,l+1,3);if(l+=3,w){if(1==w)c=I,h=U,f=9,p=5;else if(2==w){var _=R(e,l,31)+257,x=R(e,l+10,15)+4,S=_+R(e,l+5,31)+1;l+=14;for(var E=new d(S),T=new d(19),A=0;A<x;++A)T[g[A]]=R(e,l+3*A,7);l+=3*x;for(var k=O(T),C=(1<<k)-1,V=P(T,k,1),A=0;A<S;){var j=V[R(e,l,C)];l+=15&j;var z=j>>>4;if(z<16)E[A++]=z;else{var B=0,H=0;for(16==z?(H=3+R(e,l,3),l+=2,B=E[A-1]):17==z?(H=3+R(e,l,7),l+=3):18==z&&(H=11+R(e,l,127),l+=7);H--;)E[A++]=B}}var N=E.subarray(0,_),W=E.subarray(_);f=O(N),p=O(W),c=P(N,f,1),h=P(W,p,1)}else throw"invalid block type"}else{var z=F(l)+4,$=e[z-4]|e[z-3]<<8,q=z+$;if(q>i){if(a)throw"unexpected EOF";break}n&&s(u+$),t.set(e.subarray(z,q),u),r.b=u+=$,r.p=l=8*q;continue}if(l>y){if(a)throw"unexpected EOF";break}}n&&s(u+131072);for(var G=(1<<f)-1,X=(1<<p)-1,Y=l;;Y=l){var B=c[D(e,l)&G],K=B>>>4;if((l+=15&B)>y){if(a)throw"unexpected EOF";break}if(!B)throw"invalid length/literal";if(K<256)t[u++]=K;else if(256==K){Y=l,c=null;break}else{var Z=K-254;if(K>264){var A=K-257,Q=m[A];Z=R(e,l,(1<<Q)-1)+b[A],l+=Q}var J=h[D(e,l)&X],ee=J>>>4;if(!J)throw"invalid distance";l+=15&J;var W=M[ee];if(ee>3){var Q=v[ee];W+=D(e,l)&(1<<Q)-1,l+=Q}if(l>y){if(a)throw"unexpected EOF";break}n&&s(u+131072);for(var et=u+Z;u<et;u+=4)t[u]=t[u-W],t[u+1]=t[u+1-W],t[u+2]=t[u+2-W],t[u+3]=t[u+3-W];u=et}}r.l=c,r.p=Y,r.b=u,c&&(o=1,r.m=f,r.d=h,r.n=p)}while(!o);return u==t.length?t:L(t,0,u)},j=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8},z=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},B=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var n=r.length,a=r.slice();if(!n)return[X,0];if(1==n){var s=new d(r[0].s+1);return s[r[0].s]=1,[s,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var o=r[0],l=r[1],u=0,c=1,h=2;for(r[0]={s:-1,f:o.f+l.f,l:o,r:l};c!=n-1;)o=r[r[u].f<r[h].f?u++:h++],l=r[u!=c&&r[u].f<r[h].f?u++:h++],r[c++]={s:-1,f:o.f+l.f,l:o,r:l};for(var p=a[0].s,i=1;i<n;++i)a[i].s>p&&(p=a[i].s);var m=new f(p+1),v=H(r[c-1],m,0);if(v>t){var i=0,g=0,y=v-t,w=1<<y;for(a.sort(function(e,t){return m[t.s]-m[e.s]||e.f-t.f});i<n;++i){var b=a[i].s;if(m[b]>t)g+=w-(1<<v-m[b]),m[b]=t;else break}for(g>>>=y;g>0;){var _=a[i].s;m[_]<t?g-=1<<t-m[_]++-1:++i}for(;i>=0&&g;--i){var x=a[i].s;m[x]==t&&(--m[x],++g)}v=t}return[new d(m),v]},H=function(e,t,r){return -1==e.s?Math.max(H(e.l,t,r+1),H(e.r,t,r+1)):t[e.s]=r},N=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new f(++t),i=0,n=e[0],a=1,s=function(e){r[i++]=e},o=1;o<=t;++o)if(e[o]==n&&o!=t)++a;else{if(!n&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(n),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(n);a=1,n=e[o]}return[r.subarray(0,i),t]},W=function(e,t){for(var r=0,i=0;i<t.length;++i)r+=e[i]*t[i];return r},$=function(e,t,r){var i=r.length,n=F(t+2);e[n]=255&i,e[n+1]=i>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var a=0;a<i;++a)e[n+a+4]=r[a];return(n+4+i)*8},q=function(e,t,r,i,n,a,s,o,l,u,c){j(t,c++,r),++n[256];for(var h,d,p,y,w=B(n,15),b=w[0],_=w[1],x=B(a,15),M=x[0],S=x[1],E=N(b),T=E[0],A=E[1],I=N(M),U=I[0],O=I[1],R=new f(19),D=0;D<T.length;++D)R[31&T[D]]++;for(var D=0;D<U.length;++D)R[31&U[D]]++;for(var F=B(R,7),L=F[0],V=F[1],H=19;H>4&&!L[g[H-1]];--H);var q=u+5<<3,G=W(n,k)+W(a,C)+s,X=W(n,b)+W(a,M)+s+14+3*H+W(R,L)+(2*R[16]+3*R[17]+7*R[18]);if(q<=G&&q<=X)return $(t,c,e.subarray(l,l+u));if(j(t,c,1+(X<G)),c+=2,X<G){h=P(b,_,0),d=b,p=P(M,S,0),y=M;var Y=P(L,V,0);j(t,c,A-257),j(t,c+5,O-1),j(t,c+10,H-4),c+=14;for(var D=0;D<H;++D)j(t,c+3*D,L[g[D]]);c+=3*H;for(var K=[T,U],Z=0;Z<2;++Z)for(var Q=K[Z],D=0;D<Q.length;++D){var J=31&Q[D];j(t,c,Y[J]),c+=L[J],J>15&&(j(t,c,Q[D]>>>5&127),c+=Q[D]>>>12)}}else h=null,d=k,p=null,y=C;for(var D=0;D<o;++D)if(i[D]>255){var J=i[D]>>>18&31;z(t,c,h[J+257]),c+=d[J+257],J>7&&(j(t,c,i[D]>>>23&31),c+=m[J]);var ee=31&i[D];z(t,c,p[ee]),c+=y[ee],ee>3&&(z(t,c,i[D]>>>5&8191),c+=v[ee])}else z(t,c,h[i[D]]),c+=d[i[D]];return z(t,c,h[256]),c+d[256]},G=new p([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),X=new d(0),Y=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function K(e,t){return V((Y(e),e.subarray(2,-4)),t)}var Z="undefined"!=typeof TextDecoder&&new TextDecoder;try{Z.decode(X,{stream:!0})}catch(e){}let Q="colorSpace"in new o.Texture;class J extends o.DataTextureLoader{constructor(e){super(e),this.type=o.HalfFloatType}parse(e){let t={l:0,c:0,lc:0};function r(e,r,i,n,a){for(;i<e;)r=r<<8|T(n,a),i+=8;i-=e,t.l=r>>i&(1<<e)-1,t.c=r,t.lc=i}let i=Array(59),n={c:0,lc:0};function a(e,t,r,i){e=e<<8|T(r,i),t+=8,n.c=e,n.lc=t}let s={c:0,lc:0};function l(e,t,r,i,o,l,u,c,h,d){if(e==t){i<8&&(a(r,i,o,u),r=n.c,i=n.lc);var f=r>>(i-=8),f=new Uint8Array([f])[0];if(h.value+f>d)return!1;for(var p=c[h.value-1];f-- >0;)c[h.value++]=p}else{if(!(h.value<d))return!1;c[h.value++]=e}s.c=r,s.lc=i}function u(e){var t=65535&e;return t>32767?t-65536:t}let c={a:0,b:0};function h(e,t){var r=u(e),i=u(t),n=r+(1&i)+(i>>1),a=n-i;c.a=n,c.b=a}function d(e,t){var r=65535&t,i=(65535&e)-(r>>1)&65535;c.a=r+i-32768&65535,c.b=i}function f(e,o,u,c,h,d){var f=u.value,p=E(o,u),m=E(o,u);u.value+=4;var v=E(o,u);if(u.value+=4,p<0||p>=65537||m<0||m>=65537)throw"Something wrong with HUF_ENCSIZE";var g=Array(65537),y=Array(16384);!function(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(y);var w=c-(u.value-f);if(!function(e,n,a,s,o,l,u){for(var c=0,h=0;o<=l;o++){if(a.value-a.value>s)return!1;r(6,c,h,e,a);var d=t.l;if(c=t.c,h=t.lc,u[o]=d,63==d){if(a.value-a.value>s)throw"Something wrong with hufUnpackEncTable";r(8,c,h,e,a);var f=t.l+6;if(c=t.c,h=t.lc,o+f>l+1)throw"Something wrong with hufUnpackEncTable";for(;f--;)u[o++]=0;o--}else if(d>=59){var f=d-59+2;if(o+f>l+1)throw"Something wrong with hufUnpackEncTable";for(;f--;)u[o++]=0;o--}}!function(e){for(var t=0;t<=58;++t)i[t]=0;for(var t=0;t<65537;++t)i[e[t]]+=1;for(var r=0,t=58;t>0;--t){var n=r+i[t]>>1;i[t]=r,r=n}for(var t=0;t<65537;++t){var a=e[t];a>0&&(e[t]=a|i[a]++<<6)}}(u)}(e,0,u,w,p,m,g),v>8*(c-(u.value-f)))throw"Something wrong with hufUncompress";!function(e,t,r,i){for(;t<=r;t++){var n=e[t]>>6,a=63&e[t];if(n>>a)throw"Invalid table entry";if(a>14){var s=i[n>>a-14];if(s.len)throw"Invalid table entry";if(s.lit++,s.p){var o=s.p;s.p=Array(s.lit);for(var l=0;l<s.lit-1;++l)s.p[l]=o[l]}else s.p=[,];s.p[s.lit-1]=t}else if(a)for(var u=0,l=1<<14-a;l>0;l--){var s=i[(n<<14-a)+u];if(s.len||s.p)throw"Invalid table entry";s.len=a,s.lit=t,u++}}}(g,p,m,y),function(e,t,r,i,o,u,c,h,d,f){for(var p=0,m=0,v=Math.trunc(o.value+(u+7)/8);o.value<v;)for(a(p,m,r,o),p=n.c,m=n.lc;m>=14;){var g=t[p>>m-14&16383];if(g.len)m-=g.len,l(g.lit,c,p,m,r,i,o,d,f,h),p=s.c,m=s.lc;else{if(!g.p)throw"hufDecode issues";for(y=0;y<g.lit;y++){for(var y,w=63&e[g.p[y]];m<w&&o.value<v;)a(p,m,r,o),p=n.c,m=n.lc;if(m>=w&&e[g.p[y]]>>6==(p>>m-w&(1<<w)-1)){m-=w,l(g.p[y],c,p,m,r,i,o,d,f,h),p=s.c,m=s.lc;break}}if(y==g.lit)throw"hufDecode issues"}}var b=8-u&7;for(p>>=b,m-=b;m>0;){var g=t[p<<14-m&16383];if(g.len)m-=g.len,l(g.lit,c,p,m,r,i,o,d,f,h),p=s.c,m=s.lc;else throw"hufDecode issues"}}(g,y,e,o,u,v,m,d,h,{value:0})}function p(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function m(e,t){for(var r=0,i=Math.floor((e.length+1)/2),n=0,a=e.length-1;!(n>a)&&(t[n++]=e[r++],!(n>a));)t[n++]=e[i++]}function v(e){for(var t=e.byteLength,r=[],i=0,n=new DataView(e);t>0;){var a=n.getInt8(i++);if(a<0){var s=-a;t-=s+1;for(var o=0;o<s;o++)r.push(n.getUint8(i++))}else{var s=a;t-=2;for(var l=n.getUint8(i++),o=0;o<s+1;o++)r.push(l)}}return r}function g(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function y(e){var t=new Uint8Array(v(e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size))),r=new Uint8Array(t.length);return p(t),m(t,r),new DataView(r.buffer)}function w(e){var t=K(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return p(t),m(t,r),new DataView(r.buffer)}function b(e){for(var t=e.viewer,r={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),n=new Uint8Array(8192),a=0,s=Array(e.channels),o=0;o<e.channels;o++)s[o]={},s[o].start=a,s[o].end=s[o].start,s[o].nx=e.width,s[o].ny=e.lines,s[o].size=e.type,a+=s[o].nx*s[o].ny*s[o].size;var l=U(t,r),u=U(t,r);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(l<=u)for(var o=0;o<u-l+1;o++)n[o+l]=A(t,r);var p=new Uint16Array(65536),m=function(e,t){for(var r=0,i=0;i<65536;++i)(0==i||e[i>>3]&1<<(7&i))&&(t[r++]=i);for(var n=r-1;r<65536;)t[r++]=0;return n}(n,p),v=E(t,r);f(e.array,t,r,v,i,a);for(var o=0;o<e.channels;++o)for(var g=s[o],y=0;y<s[o].size;++y)!function(e,t,r,i,n,a,s){for(var o=s<16384,l=r>n?n:r,u=1;u<=l;)u<<=1;for(u>>=1,f=u,u>>=1;u>=1;){for(var f,p,m,v,g,y=0,w=0+a*(n-f),b=a*u,_=a*f,x=i*u,M=i*f;y<=w;y+=_){for(var S=y,E=y+i*(r-f);S<=E;S+=M){var T=S+x,A=S+b,P=A+x;o?(h(e[S+t],e[A+t]),p=c.a,v=c.b,h(e[T+t],e[P+t]),m=c.a,g=c.b,h(p,m),e[S+t]=c.a,e[T+t]=c.b,h(v,g)):(d(e[S+t],e[A+t]),p=c.a,v=c.b,d(e[T+t],e[P+t]),m=c.a,g=c.b,d(p,m),e[S+t]=c.a,e[T+t]=c.b,d(v,g)),e[A+t]=c.a,e[P+t]=c.b}if(r&u){var A=S+b;o?h(e[S+t],e[A+t]):d(e[S+t],e[A+t]),p=c.a,e[A+t]=c.b,e[S+t]=p}}if(n&u)for(var S=y,E=y+i*(r-f);S<=E;S+=M){var T=S+x;o?h(e[S+t],e[T+t]):d(e[S+t],e[T+t]),p=c.a,e[T+t]=c.b,e[S+t]=p}f=u,u>>=1}}(i,g.start+y,g.nx,g.size,g.ny,g.nx*g.size,m);!function(e,t,r){for(var i=0;i<r;++i)t[i]=e[t[i]]}(p,i,a);for(var w=0,b=new Uint8Array(i.buffer.byteLength),_=0;_<e.lines;_++)for(var x=0;x<e.channels;x++){var g=s[x],M=g.nx*g.size,S=new Uint8Array(i.buffer,2*g.end,2*M);b.set(S,w),w+=2*M,g.end+=M}return new DataView(b.buffer)}function _(e){var t=K(e.array.slice(e.offset.value,e.offset.value+e.size));let r=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(r):new Uint32Array(r),n=0,a=0,s=[,,,,];for(let r=0;r<e.lines;r++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:s[0]=n,s[1]=s[0]+e.width,n=s[1]+e.width;for(let n=0;n<e.width;++n)r+=t[s[0]++]<<8|t[s[1]++],i[a]=r,a++;break;case 2:s[0]=n,s[1]=s[0]+e.width,s[2]=s[1]+e.width,n=s[2]+e.width;for(let n=0;n<e.width;++n)r+=t[s[0]++]<<24|t[s[1]++]<<16|t[s[2]++]<<8,i[a]=r,a++}}return new DataView(i.buffer)}function x(e){var t=e.viewer,r={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),n={version:P(t,r),unknownUncompressedSize:P(t,r),unknownCompressedSize:P(t,r),acCompressedSize:P(t,r),dcCompressedSize:P(t,r),rleCompressedSize:P(t,r),rleUncompressedSize:P(t,r),rleRawSize:P(t,r),totalAcUncompressedCount:P(t,r),totalDcUncompressedCount:P(t,r),acCompression:P(t,r)};if(n.version<2)throw"EXRLoader.parse: "+L.compression+" version "+n.version+" is unsupported";for(var a=[],s=U(t,r)-2;s>0;){var l=M(t.buffer,r),u=A(t,r),c=u>>2&3,h=new Int8Array([(u>>4)-1])[0],d=A(t,r);a.push({name:l,index:h,type:d,compression:c}),s-=l.length+3}for(var p=L.channels,m=Array(e.channels),g=0;g<e.channels;++g){var y=m[g]={},b=p[g];y.name=b.name,y.compression=0,y.decoded=!1,y.type=b.pixelType,y.pLinear=b.pLinear,y.width=e.width,y.height=e.lines}for(var _={idx:[,,,]},x=0;x<e.channels;++x)for(var y=m[x],g=0;g<a.length;++g){var S=a[g];y.name==S.name&&(y.compression=S.compression,S.index>=0&&(_.idx[S.index]=x),y.offset=x)}if(n.acCompressedSize>0)switch(n.acCompression){case 0:var E=new Uint16Array(n.totalAcUncompressedCount);f(e.array,t,r,n.acCompressedSize,E,n.totalAcUncompressedCount);break;case 1:var T=e.array.slice(r.value,r.value+n.totalAcUncompressedCount),k=K(T),E=new Uint16Array(k.buffer);r.value+=n.totalAcUncompressedCount}if(n.dcCompressedSize>0){var C=new Uint16Array(w({array:e.array,offset:r,size:n.dcCompressedSize}).buffer);r.value+=n.dcCompressedSize}if(n.rleRawSize>0){var T=e.array.slice(r.value,r.value+n.rleCompressedSize),k=K(T),O=v(k.buffer);r.value+=n.rleCompressedSize}for(var R=0,D=Array(m.length),g=0;g<D.length;++g)D[g]=[];for(var F=0;F<e.lines;++F)for(var V=0;V<m.length;++V)D[V].push(R),R+=m[V].width*e.type*2;!function(e,t,r,i,n,a){var s=new DataView(a.buffer),l=r[e.idx[0]].width,u=r[e.idx[0]].height,c=Math.floor(l/8),h=Math.ceil(l/8),d=Math.ceil(u/8),f=l-(h-1)*8,p=u-(d-1)*8,m={value:0},v=[,,,],g=[,,,],y=[,,,],w=[,,,],b=[,,,];for(let r=0;r<3;++r)b[r]=t[e.idx[r]],v[r]=r<1?0:v[r-1]+h*d,g[r]=new Float32Array(64),y[r]=new Uint16Array(64),w[r]=new Uint16Array(64*h);for(let t=0;t<d;++t){var _,x,M=8;t==d-1&&(M=p);var S=8;for(let e=0;e<h;++e){e==h-1&&(S=f);for(let e=0;e<3;++e)y[e].fill(0),y[e][0]=n[v[e]++],function(e,t,r){for(var i,n=1;n<64;)65280==(i=t[e.value])?n=64:i>>8==255?n+=255&i:(r[n]=i,n++),e.value++}(m,i,y[e]),_=y[e],(x=g[e])[0]=I(_[0]),x[1]=I(_[1]),x[2]=I(_[5]),x[3]=I(_[6]),x[4]=I(_[14]),x[5]=I(_[15]),x[6]=I(_[27]),x[7]=I(_[28]),x[8]=I(_[2]),x[9]=I(_[4]),x[10]=I(_[7]),x[11]=I(_[13]),x[12]=I(_[16]),x[13]=I(_[26]),x[14]=I(_[29]),x[15]=I(_[42]),x[16]=I(_[3]),x[17]=I(_[8]),x[18]=I(_[12]),x[19]=I(_[17]),x[20]=I(_[25]),x[21]=I(_[30]),x[22]=I(_[41]),x[23]=I(_[43]),x[24]=I(_[9]),x[25]=I(_[11]),x[26]=I(_[18]),x[27]=I(_[24]),x[28]=I(_[31]),x[29]=I(_[40]),x[30]=I(_[44]),x[31]=I(_[53]),x[32]=I(_[10]),x[33]=I(_[19]),x[34]=I(_[23]),x[35]=I(_[32]),x[36]=I(_[39]),x[37]=I(_[45]),x[38]=I(_[52]),x[39]=I(_[54]),x[40]=I(_[20]),x[41]=I(_[22]),x[42]=I(_[33]),x[43]=I(_[38]),x[44]=I(_[46]),x[45]=I(_[51]),x[46]=I(_[55]),x[47]=I(_[60]),x[48]=I(_[21]),x[49]=I(_[34]),x[50]=I(_[37]),x[51]=I(_[47]),x[52]=I(_[50]),x[53]=I(_[56]),x[54]=I(_[59]),x[55]=I(_[61]),x[56]=I(_[35]),x[57]=I(_[36]),x[58]=I(_[48]),x[59]=I(_[49]),x[60]=I(_[57]),x[61]=I(_[58]),x[62]=I(_[62]),x[63]=I(_[63]),function(e){let t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),n=.5*Math.cos(3*3.14159/8);for(var a=[,,,,],s=[,,,,],o=[,,,,],l=[,,,,],u=0;u<8;++u){var c=8*u;a[0]=r*e[c+2],a[1]=n*e[c+2],a[2]=r*e[c+6],a[3]=n*e[c+6],s[0]=t*e[c+1]+i*e[c+3]+.2777854612564676*e[c+5]+.09754573032714427*e[c+7],s[1]=i*e[c+1]-.09754573032714427*e[c+3]-t*e[c+5]-.2777854612564676*e[c+7],s[2]=.2777854612564676*e[c+1]-t*e[c+3]+.09754573032714427*e[c+5]+i*e[c+7],s[3]=.09754573032714427*e[c+1]-.2777854612564676*e[c+3]+i*e[c+5]-t*e[c+7],o[0]=.35355362513961314*(e[c+0]+e[c+4]),o[3]=.35355362513961314*(e[c+0]-e[c+4]),o[1]=a[0]+a[3],o[2]=a[1]-a[2],l[0]=o[0]+o[1],l[1]=o[3]+o[2],l[2]=o[3]-o[2],l[3]=o[0]-o[1],e[c+0]=l[0]+s[0],e[c+1]=l[1]+s[1],e[c+2]=l[2]+s[2],e[c+3]=l[3]+s[3],e[c+4]=l[3]-s[3],e[c+5]=l[2]-s[2],e[c+6]=l[1]-s[1],e[c+7]=l[0]-s[0]}for(var h=0;h<8;++h)a[0]=r*e[16+h],a[1]=n*e[16+h],a[2]=r*e[48+h],a[3]=n*e[48+h],s[0]=t*e[8+h]+i*e[24+h]+.2777854612564676*e[40+h]+.09754573032714427*e[56+h],s[1]=i*e[8+h]-.09754573032714427*e[24+h]-t*e[40+h]-.2777854612564676*e[56+h],s[2]=.2777854612564676*e[8+h]-t*e[24+h]+.09754573032714427*e[40+h]+i*e[56+h],s[3]=.09754573032714427*e[8+h]-.2777854612564676*e[24+h]+i*e[40+h]-t*e[56+h],o[0]=.35355362513961314*(e[h]+e[32+h]),o[3]=.35355362513961314*(e[h]-e[32+h]),o[1]=a[0]+a[3],o[2]=a[1]-a[2],l[0]=o[0]+o[1],l[1]=o[3]+o[2],l[2]=o[3]-o[2],l[3]=o[0]-o[1],e[0+h]=l[0]+s[0],e[8+h]=l[1]+s[1],e[16+h]=l[2]+s[2],e[24+h]=l[3]+s[3],e[32+h]=l[3]-s[3],e[40+h]=l[2]-s[2],e[48+h]=l[1]-s[1],e[56+h]=l[0]-s[0]}(g[e]);!function(e){for(var t=0;t<64;++t){var r=e[0][t],i=e[1][t],n=e[2][t];e[0][t]=r+1.5747*n,e[1][t]=r-.1873*i-.4682*n,e[2][t]=r+1.8556*i}}(g);for(let t=0;t<3;++t)!function(e,t,r){for(var i,n=0;n<64;++n)t[r+n]=o.DataUtils.toHalfFloat((i=e[n])<=1?Math.sign(i)*Math.pow(Math.abs(i),2.2):Math.sign(i)*Math.pow(9.025013291561939,Math.abs(i)-1))}(g[t],w[t],64*e)}let a=0;for(let i=0;i<3;++i){let n=r[e.idx[i]].type;for(let e=8*t;e<8*t+M;++e){a=b[i][e];for(let t=0;t<c;++t){let r=64*t+(7&e)*8;s.setUint16(a+0*n,w[i][r+0],!0),s.setUint16(a+2*n,w[i][r+1],!0),s.setUint16(a+4*n,w[i][r+2],!0),s.setUint16(a+6*n,w[i][r+3],!0),s.setUint16(a+8*n,w[i][r+4],!0),s.setUint16(a+10*n,w[i][r+5],!0),s.setUint16(a+12*n,w[i][r+6],!0),s.setUint16(a+14*n,w[i][r+7],!0),a+=16*n}}if(c!=h)for(let e=8*t;e<8*t+M;++e){let t=b[i][e]+8*c*2*n,r=64*c+(7&e)*8;for(let e=0;e<S;++e)s.setUint16(t+2*e*n,w[i][r+e],!0)}}}for(var E=new Uint16Array(l),s=new DataView(a.buffer),T=0;T<3;++T){r[e.idx[T]].decoded=!0;var A=r[e.idx[T]].type;if(2==r[T].type)for(var P=0;P<u;++P){let e=b[T][P];for(var k=0;k<l;++k)E[k]=s.getUint16(e+2*k*A,!0);for(var k=0;k<l;++k)s.setFloat32(e+2*k*A,I(E[k]),!0)}}}(_,D,m,E,C,i);for(var g=0;g<m.length;++g){var y=m[g];if(!y.decoded){if(2===y.compression)for(var j=0,z=0,F=0;F<e.lines;++F){for(var B=D[g][j],H=0;H<y.width;++H){for(var N=0;N<2*y.type;++N)i[B++]=O[z+N*y.width*y.height];z++}j++}else throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(i.buffer)}function M(e,t){for(var r=new Uint8Array(e),i=0;0!=r[t.value+i];)i+=1;var n=new TextDecoder().decode(r.slice(t.value,t.value+i));return t.value=t.value+i+1,n}function S(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function E(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function T(e,t){var r=e[t.value];return t.value=t.value+1,r}function A(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}let P=function(e,t){let r;return"getBigInt64"in DataView.prototype?r=Number(e.getBigInt64(t.value,!0)):r=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function k(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function C(e,t){return o.DataUtils.toHalfFloat(k(e,t))}function I(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function U(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function O(e,t){return I(U(e,t))}let R=new DataView(e),D=new Uint8Array(e),F={value:0},L=function(e,t,r){let i={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";i.version=e.getUint8(4);let n=e.getUint8(5);i.spec={singleTile:!!(2&n),longName:!!(4&n),deepFormat:!!(8&n),multiPart:!!(16&n)},r.value=8;for(var a=!0;a;){var s=M(t,r);if(0==s)a=!1;else{var o=M(t,r),l=E(e,r),u=function(e,t,r,i,n){var a,s,o,l,u;if("string"===i||"stringvector"===i||"iccProfile"===i)return a=new TextDecoder().decode(new Uint8Array(t).slice(r.value,r.value+n)),r.value=r.value+n,a;if("chlist"===i)return function(e,t,r,i){for(var n=r.value,a=[];r.value<n+i-1;){var s=M(t,r),o=S(e,r),l=A(e,r);r.value+=3;var u=S(e,r),c=S(e,r);a.push({name:s,pixelType:o,pLinear:l,xSampling:u,ySampling:c})}return r.value+=1,a}(e,t,r,n);if("chromaticities"===i)return s=k(e,r),o=k(e,r),l=k(e,r),u=k(e,r),{redX:s,redY:o,greenX:l,greenY:u,blueX:k(e,r),blueY:k(e,r),whiteX:k(e,r),whiteY:k(e,r)};if("compression"===i)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][A(e,r)];if("box2i"===i)return{xMin:E(e,r),yMin:E(e,r),xMax:E(e,r),yMax:E(e,r)};if("lineOrder"===i)return["INCREASING_Y"][A(e,r)];if("float"===i)return k(e,r);else if("v2f"===i)return[k(e,r),k(e,r)];else if("v3f"===i)return[k(e,r),k(e,r),k(e,r)];else if("int"===i)return S(e,r);else if("rational"===i)return[S(e,r),E(e,r)];else if("timecode"===i)return[E(e,r),E(e,r)];else return"preview"===i?(r.value+=n,"skipped"):void(r.value+=n)}(e,t,r,o,l);void 0===u?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${o}'.`):i[s]=u}}if((-5&n)!=0)throw console.error("EXRHeader:",i),"THREE.EXRLoader: provided file is currently unsupported.";return i}(R,e,F),V=function(e,t,r,i,n){let a={size:0,viewer:t,array:r,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Q?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":a.lines=1,a.uncompress=g;break;case"RLE_COMPRESSION":a.lines=1,a.uncompress=y;break;case"ZIPS_COMPRESSION":a.lines=1,a.uncompress=w;break;case"ZIP_COMPRESSION":a.lines=16,a.uncompress=w;break;case"PIZ_COMPRESSION":a.lines=32,a.uncompress=b;break;case"PXR24_COMPRESSION":a.lines=16,a.uncompress=_;break;case"DWAA_COMPRESSION":a.lines=32,a.uncompress=x;break;case"DWAB_COMPRESSION":a.lines=256,a.uncompress=x;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(a.scanlineBlockSize=a.lines,1==a.type)switch(n){case o.FloatType:a.getter=O,a.inputSize=2;break;case o.HalfFloatType:a.getter=U,a.inputSize=2}else if(2==a.type)switch(n){case o.FloatType:a.getter=k,a.inputSize=4;break;case o.HalfFloatType:a.getter=C,a.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+a.type+" for "+e.compression+".";a.blockCount=(e.dataWindow.yMax+1)/a.scanlineBlockSize;for(var s=0;s<a.blockCount;s++)P(t,i);a.outputChannels=3==a.channels?4:a.channels;let l=a.width*a.height*a.outputChannels;switch(n){case o.FloatType:a.byteArray=new Float32Array(l),a.channels<a.outputChannels&&a.byteArray.fill(1,0,l);break;case o.HalfFloatType:a.byteArray=new Uint16Array(l),a.channels<a.outputChannels&&a.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",n)}return a.bytesPerLine=a.width*a.inputSize*a.channels,4==a.outputChannels?a.format=o.RGBAFormat:a.format=o.RedFormat,Q?a.colorSpace="srgb-linear":a.encoding=3e3,a}(L,R,D,F,this.type),j={value:0},z={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<V.height/V.scanlineBlockSize;e++){let t=E(R,F);V.size=E(R,F),V.lines=t+V.scanlineBlockSize>V.height?V.height-t:V.scanlineBlockSize;let r=V.size<V.lines*V.bytesPerLine?V.uncompress(V):g(V);F.value+=V.size;for(let t=0;t<V.scanlineBlockSize;t++){let i=t+e*V.scanlineBlockSize;if(i>=V.height)break;for(let e=0;e<V.channels;e++){let n=z[L.channels[e].name];for(let a=0;a<V.width;a++){j.value=(V.channels*V.width*t+e*V.width+a)*V.inputSize;let s=(V.height-1-i)*(V.width*V.outputChannels)+a*V.outputChannels+n;V.byteArray[s]=V.getter(r,j)}}}}return{header:L,width:V.width,height:V.height,data:V.byteArray,format:V.format,[Q?"colorSpace":"encoding"]:V[Q?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,function(e,r){Q?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=o.LinearFilter,e.magFilter=o.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,i)}}let ee=(e,t,r)=>{let i;switch(e){case o.UnsignedByteType:i=new Uint8ClampedArray(t*r*4);break;case o.HalfFloatType:i=new Uint16Array(t*r*4);break;case o.UnsignedIntType:i=new Uint32Array(t*r*4);break;case o.ByteType:i=new Int8Array(t*r*4);break;case o.ShortType:i=new Int16Array(t*r*4);break;case o.IntType:i=new Int32Array(t*r*4);break;case o.FloatType:i=new Float32Array(t*r*4);break;default:throw Error("Unsupported data type")}return i},et=(e,t,r,n)=>{if(void 0!==i)return i;let a=new o.WebGLRenderTarget(1,1,n);t.setRenderTarget(a);let s=new o.Mesh(new o.PlaneGeometry,new o.MeshBasicMaterial({color:16777215}));t.render(s,r),t.setRenderTarget(null);let l=ee(e,a.width,a.height);return t.readRenderTargetPixels(a,0,0,a.width,a.height,l),a.dispose(),s.geometry.dispose(),s.material.dispose(),i=0!==l[0]};class er{constructor(e){var t,r,i,n,a,s,l,u,c,h,d,f,p,m,v,g;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;let y={format:o.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)!==void 0?null===(r=e.renderTargetOptions)||void 0===r?void 0:r.anisotropy:1,generateMipmaps:(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.generateMipmaps)!==void 0&&(null===(n=e.renderTargetOptions)||void 0===n?void 0:n.generateMipmaps),magFilter:(null===(a=e.renderTargetOptions)||void 0===a?void 0:a.magFilter)!==void 0?null===(s=e.renderTargetOptions)||void 0===s?void 0:s.magFilter:o.LinearFilter,minFilter:(null===(l=e.renderTargetOptions)||void 0===l?void 0:l.minFilter)!==void 0?null===(u=e.renderTargetOptions)||void 0===u?void 0:u.minFilter:o.LinearFilter,samples:(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples)!==void 0?null===(h=e.renderTargetOptions)||void 0===h?void 0:h.samples:void 0,wrapS:(null===(d=e.renderTargetOptions)||void 0===d?void 0:d.wrapS)!==void 0?null===(f=e.renderTargetOptions)||void 0===f?void 0:f.wrapS:o.ClampToEdgeWrapping,wrapT:(null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapT)!==void 0?null===(m=e.renderTargetOptions)||void 0===m?void 0:m.wrapT:o.ClampToEdgeWrapping};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=er.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new o.Scene,this._camera=new o.OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!et(this._type,this._renderer,this._camera,y)){let e;this._type===o.HalfFloatType&&(e=this._renderer.extensions.has("EXT_color_buffer_float")?o.FloatType:void 0),void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${o.FloatType}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new o.Mesh(new o.PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new o.WebGLRenderTarget(this.width,this.height,y),this._renderTarget.texture.mapping=(null===(v=e.renderTargetOptions)||void 0===v?void 0:v.mapping)!==void 0?null===(g=e.renderTargetOptions)||void 0===g?void 0:g.mapping:o.UVMapping}static instantiateRenderer(){let e=new o.WebGLRenderer;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let e=ee(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){let t=new o.DataTexture(this.toArray(),this.width,this.height,o.RGBAFormat,this._type,(null==e?void 0:e.mapping)||o.UVMapping,(null==e?void 0:e.wrapS)||o.ClampToEdgeWrapping,(null==e?void 0:e.wrapT)||o.ClampToEdgeWrapping,(null==e?void 0:e.magFilter)||o.LinearFilter,(null==e?void 0:e.minFilter)||o.LinearFilter,(null==e?void 0:e.anisotropy)||1,o.LinearSRGBColorSpace);return t.generateMipmaps=(null==e?void 0:e.generateMipmaps)!==void 0&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof o.ShaderMaterial&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof o.Texture&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof o.Texture&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}let ei=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,en=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class ea extends o.ShaderMaterial{constructor({gamma:e,offsetHdr:t,offsetSdr:r,gainMapMin:i,gainMapMax:n,maxDisplayBoost:a,hdrCapacityMin:s,hdrCapacityMax:l,sdr:u,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:ei,fragmentShader:en,uniforms:{sdr:{value:u},gainMap:{value:c},gamma:{value:new o.Vector3(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new o.Vector3().fromArray(t)},offsetSdr:{value:new o.Vector3().fromArray(r)},gainMapMin:{value:new o.Vector3().fromArray(i)},gainMapMax:{value:new o.Vector3().fromArray(n)},weightFactor:{value:(Math.log2(a)-s)/(l-s)}},blending:o.NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=s,this._hdrCapacityMax=l,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){let e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){let t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){let e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class es extends Error{}class eo extends Error{}let el=(e,t,r)=>{var i;let n;let a=null===(i=e.attributes.getNamedItem(t))||void 0===i?void 0:i.nodeValue;if(a)n=a;else{let i=e.getElementsByTagName(t)[0];if(i){let e=i.getElementsByTagName("rdf:li");if(3===e.length)n=Array.from(e).map(e=>e.innerHTML);else throw Error(`Gainmap metadata contains an array of items for ${t} but its length is not 3`)}else{if(r)return r;throw Error(`Can't find ${t} in gainmap metadata`)}}return n},eu=e=>{var t,r;let i;"undefined"!=typeof TextDecoder?i=new TextDecoder().decode(e):i=e.toString();let n=i.indexOf("<x:xmpmeta"),a=new DOMParser;for(;-1!==n;){let e=i.indexOf("x:xmpmeta>",n);i.slice(n,e+10);let s=i.slice(n,e+10);try{let e=a.parseFromString(s,"text/xml").getElementsByTagName("rdf:Description")[0],i=el(e,"hdrgm:GainMapMin","0"),n=el(e,"hdrgm:GainMapMax"),o=el(e,"hdrgm:Gamma","1"),l=el(e,"hdrgm:OffsetSDR","0.015625"),u=el(e,"hdrgm:OffsetHDR","0.015625"),c=null===(t=e.attributes.getNamedItem("hdrgm:HDRCapacityMin"))||void 0===t?void 0:t.nodeValue;c||(c="0");let h=null===(r=e.attributes.getNamedItem("hdrgm:HDRCapacityMax"))||void 0===r?void 0:r.nodeValue;if(!h)throw Error("Incomplete gainmap metadata");return{gainMapMin:Array.isArray(i)?i.map(e=>parseFloat(e)):[parseFloat(i),parseFloat(i),parseFloat(i)],gainMapMax:Array.isArray(n)?n.map(e=>parseFloat(e)):[parseFloat(n),parseFloat(n),parseFloat(n)],gamma:Array.isArray(o)?o.map(e=>parseFloat(e)):[parseFloat(o),parseFloat(o),parseFloat(o)],offsetSdr:Array.isArray(l)?l.map(e=>parseFloat(e)):[parseFloat(l),parseFloat(l),parseFloat(l)],offsetHdr:Array.isArray(u)?u.map(e=>parseFloat(e)):[parseFloat(u),parseFloat(u),parseFloat(u)],hdrCapacityMin:parseFloat(c),hdrCapacityMax:parseFloat(h)}}catch(e){}n=i.indexOf("<x:xmpmeta",e)}};class ec{constructor(e){this.options={debug:!!e&&void 0!==e.debug&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,r)=>{let i;let n=this.options.debug,a=new DataView(e.buffer);if(65496!==a.getUint16(0)){r(Error("Not a valid jpeg"));return}let s=a.byteLength,o=2,l=0;for(;o<s;){if(++l>250){r(Error(`Found no marker after ${l} loops ðŸ˜µ`));return}if(255!==a.getUint8(o)){r(Error(`Not a valid marker at offset 0x${o.toString(16)}, found: 0x${a.getUint8(o).toString(16)}`));return}if(i=a.getUint8(o+1),n&&console.log(`Marker: ${i.toString(16)}`),226===i){n&&console.log("Found APP2 marker (0xffe2)");let e=o+4;if(1297106432===a.getUint32(e)){let i;let n=e+4;if(18761===a.getUint16(n))i=!1;else if(19789===a.getUint16(n))i=!0;else{r(Error("No valid endianness marker found in TIFF header"));return}if(42!==a.getUint16(n+2,!i)){r(Error("Not valid TIFF data! (no 0x002A marker)"));return}let s=a.getUint32(n+4,!i);if(s<8){r(Error("Not valid TIFF data! (First offset less than 8)"));return}let o=n+s,l=a.getUint16(o,!i),u=o+2,c=0;for(let e=u;e<u+12*l;e+=12)45057===a.getUint16(e,!i)&&(c=a.getUint32(e+8,!i));let h=o+2+12*l+4,d=[];for(let e=h;e<h+16*c;e+=16){let t={MPType:a.getUint32(e,!i),size:a.getUint32(e+4,!i),dataOffset:a.getUint32(e+8,!i),dependantImages:a.getUint32(e+12,!i),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=n+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,d.push(t)}if(this.options.extractNonFII&&d.length){let e=new Blob([a]),r=[];for(let t of d){if(t.isFII&&!this.options.extractFII)continue;let i=e.slice(t.start,t.end+1,"image/jpeg");r.push(i)}t(r)}}}o+=2+a.getUint16(o+2)}})}}let eh=async e=>{let t=eu(e);if(!t)throw new eo("Gain map XMP metadata not found");let r=new ec({extractFII:!0,extractNonFII:!0}),i=await r.extract(e);if(2!==i.length)throw new es("Gain map recovery image not found");return{sdr:new Uint8Array(await i[0].arrayBuffer()),gainMap:new Uint8Array(await i[1].arrayBuffer()),metadata:t}},ed=e=>new Promise((t,r)=>{let i=document.createElement("img");i.onload=()=>{t(i)},i.onerror=e=>{r(e)},i.src=URL.createObjectURL(e)});class ef extends o.Loader{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new o.LoadingManager}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");let e=new ea({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new o.Texture,sdr:new o.Texture});return new er({width:16,height:16,type:o.HalfFloatType,colorSpace:o.LinearSRGBColorSpace,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,r,i){let n,a;let s=i?new Blob([i],{type:"image/jpeg"}):void 0,l=new Blob([r],{type:"image/jpeg"}),u=!1;if("undefined"==typeof createImageBitmap){let e=await Promise.all([s?ed(s):Promise.resolve(void 0),ed(l)]);a=e[0],n=e[1],u=!0}else{let e=await Promise.all([s?createImageBitmap(s,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(l,{imageOrientation:"flipY"})]);a=e[0],n=e[1]}let c=new o.Texture(a||new ImageData(2,2),o.UVMapping,o.ClampToEdgeWrapping,o.ClampToEdgeWrapping,o.LinearFilter,o.LinearMipMapLinearFilter,o.RGBAFormat,o.UnsignedByteType,1,o.LinearSRGBColorSpace);c.flipY=u,c.needsUpdate=!0;let h=new o.Texture(n,o.UVMapping,o.ClampToEdgeWrapping,o.ClampToEdgeWrapping,o.LinearFilter,o.LinearMipMapLinearFilter,o.RGBAFormat,o.UnsignedByteType,1,o.SRGBColorSpace);h.flipY=u,h.needsUpdate=!0,e.width=n.width,e.height=n.height,e.material.gainMap=c,e.material.sdr=h,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class ep extends ef{load([e,t,r],i,n,a){let s,l,u;let c=this.prepareQuadRenderer(),h=async()=>{if(s&&l&&u){try{await this.render(c,u,s,l)}catch(i){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(r),"function"==typeof a&&a(i),c.disposeOnDemandRenderer();return}"function"==typeof i&&i(c),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(r),c.disposeOnDemandRenderer()}},d=!0,f=0,p=0,m=!0,v=0,g=0,y=!0,w=0,b=0,_=()=>{"function"==typeof n&&n(new ProgressEvent("progress",{lengthComputable:d&&m&&y,loaded:p+g+b,total:f+v+w}))};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(r);let x=new o.FileLoader(this._internalLoadingManager);x.setResponseType("arraybuffer"),x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(e,async e=>{if("string"==typeof e)throw Error("Invalid sdr buffer");s=e,await h()},e=>{d=e.lengthComputable,p=e.loaded,f=e.total,_()},t=>{this.manager.itemError(e),"function"==typeof a&&a(t)});let M=new o.FileLoader(this._internalLoadingManager);M.setResponseType("arraybuffer"),M.setRequestHeader(this.requestHeader),M.setPath(this.path),M.setWithCredentials(this.withCredentials),M.load(t,async e=>{if("string"==typeof e)throw Error("Invalid gainmap buffer");l=e,await h()},e=>{m=e.lengthComputable,g=e.loaded,v=e.total,_()},e=>{this.manager.itemError(t),"function"==typeof a&&a(e)});let S=new o.FileLoader(this._internalLoadingManager);return S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(r,async e=>{if("string"!=typeof e)throw Error("Invalid metadata string");u=JSON.parse(e),await h()},e=>{y=e.lengthComputable,b=e.loaded,w=e.total,_()},e=>{this.manager.itemError(r),"function"==typeof a&&a(e)}),c}}class em extends ef{load(e,t,r,i){let n=this.prepareQuadRenderer(),a=new o.FileLoader(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async r=>{let a,s,o;if("string"==typeof r)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let l=new Uint8Array(r);try{let e=await eh(l);a=e.sdr,s=e.gainMap,o=e.metadata}catch(t){if(t instanceof eo||t instanceof es)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),o={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},a=l;else throw t}try{await this.render(n,o,a,s)}catch(t){this.manager.itemError(e),"function"==typeof i&&i(t),n.disposeOnDemandRenderer();return}"function"==typeof t&&t(n),this.manager.itemEnd(e),n.disposeOnDemandRenderer()},r,t=>{this.manager.itemError(e),"function"==typeof i&&i(t)}),n}}let ev={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},eg=e=>Array.isArray(e);function ey({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:t="",preset:r,encoding:i,extensions:n}={}){var a,l;let u;let h=null,d=!1;if(r){if(!(r in ev))throw Error("Preset must be one of: "+Object.keys(ev).join(", "));e=ev[r],t="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/"}let f=eg(e)&&6===e.length,p=eg(e)&&3===e.length&&e.some(e=>e.endsWith("json")),m=eg(e)?e[0]:e;if(d=eg(e),!(h="cube"===(u=f?"cube":p?"webp":m.startsWith("data:application/exr")?"exr":m.startsWith("data:application/hdr")?"hdr":m.startsWith("data:image/jpeg")?"jpg":null==(a=m.split(".").pop())||null==(a=a.split("?"))||null==(a=a.shift())?void 0:a.toLowerCase())?o.CubeTextureLoader:"hdr"===u?c:"exr"===u?J:"jpg"===u||"jpeg"===u?em:"webp"===u?ep:null))throw Error("useEnvironment: Unrecognized file extension: "+e);let v=(0,s.A)(e=>e.gl),g=(0,s.F)(h,d?[e]:e,e=>{("webp"===u||"jpg"===u||"jpeg"===u)&&e.setRenderer(v),null==e.setPath||e.setPath(t),n&&n(e)}),y=d?g[0]:g;return("jpg"===u||"jpeg"===u||"webp"===u)&&(y=null==(l=y.renderTarget)?void 0:l.texture),y.mapping=f?o.CubeReflectionMapping:o.EquirectangularReflectionMapping,"colorSpace"in y?y.colorSpace=(null!=i?i:f)?"srgb":"srgb-linear":y.encoding=(null!=i?i:f)?3001:3e3,y}let ew=e=>e.current&&e.current.isScene,eb=e=>ew(e)?e.current:e;function e_(e,t,r,i,n={}){var a,o,l,u,c;n={backgroundBlurriness:null!==(a=n.blur)&&void 0!==a?a:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...n};let h=eb(t||r),d=h.background,f=h.environment,p={backgroundBlurriness:h.backgroundBlurriness,backgroundIntensity:h.backgroundIntensity,backgroundRotation:null!==(o=null==(l=h.backgroundRotation)||null==l.clone?void 0:l.clone())&&void 0!==o?o:[0,0,0],environmentIntensity:h.environmentIntensity,environmentRotation:null!==(u=null==(c=h.environmentRotation)||null==c.clone?void 0:c.clone())&&void 0!==u?u:[0,0,0]};return"only"!==e&&(h.environment=i),e&&(h.background=i),(0,s.j)(h,n),()=>{"only"!==e&&(h.environment=f),e&&(h.background=d),(0,s.j)(h,p)}}function ex({scene:e,background:t=!1,map:r,...i}){let n=(0,s.A)(e=>e.scene);return a.useLayoutEffect(()=>{if(r)return e_(t,e,n,r,i)}),null}function eM({background:e=!1,scene:t,blur:r,backgroundBlurriness:i,backgroundIntensity:n,backgroundRotation:o,environmentIntensity:l,environmentRotation:u,...c}){let h=ey(c),d=(0,s.A)(e=>e.scene);return a.useLayoutEffect(()=>e_(e,t,d,h,{blur:r,backgroundBlurriness:i,backgroundIntensity:n,backgroundRotation:o,environmentIntensity:l,environmentRotation:u})),null}function eS({children:e,near:t=1,far:r=1e3,resolution:i=256,frames:n=1,map:l,background:u=!1,blur:c,backgroundBlurriness:h,backgroundIntensity:d,backgroundRotation:f,environmentIntensity:p,environmentRotation:m,scene:v,files:g,path:y,preset:w,extensions:b}){let _=(0,s.A)(e=>e.gl),x=(0,s.A)(e=>e.scene),M=a.useRef(null),[S]=a.useState(()=>new o.Scene),E=a.useMemo(()=>{let e=new o.WebGLCubeRenderTarget(i);return e.texture.type=o.HalfFloatType,e},[i]);a.useLayoutEffect(()=>(1===n&&M.current.update(_,S),e_(u,v,x,E.texture,{blur:c,backgroundBlurriness:h,backgroundIntensity:d,backgroundRotation:f,environmentIntensity:p,environmentRotation:m})),[e,S,E.texture,v,x,u,n,_]);let T=1;return(0,s.C)(()=>{(n===1/0||T<n)&&(M.current.update(_,S),T++)}),a.createElement(a.Fragment,null,(0,s.g)(a.createElement(a.Fragment,null,e,a.createElement("cubeCamera",{ref:M,args:[t,r,E]}),g||w?a.createElement(eM,{background:!0,files:g,preset:w,path:y,extensions:b}):l?a.createElement(ex,{background:!0,map:l,extensions:b}):null),S))}function eE(e){var t,r,i,o;let l=ey(e),c=e.map||l;a.useMemo(()=>(0,s.e)({GroundProjectedEnvImpl:u}),[]);let h=a.useMemo(()=>[c],[c]),d=null==(t=e.ground)?void 0:t.height,f=null==(r=e.ground)?void 0:r.radius,p=null!==(i=null==(o=e.ground)?void 0:o.scale)&&void 0!==i?i:1e3;return a.createElement(a.Fragment,null,a.createElement(ex,(0,n.Z)({},e,{map:c})),a.createElement("groundProjectedEnvImpl",{args:h,scale:p,height:d,radius:f}))}function eT(e){return e.ground?a.createElement(eE,e):e.map?a.createElement(ex,e):e.children?a.createElement(eS,e):a.createElement(eM,e)}},789:function(e,t,r){r.d(t,{b:function(){return s}});var i=r(2265),n=r(5238),a=r(7776);let s=i.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:s=1,floatIntensity:o=1,floatingRange:l=[-.1,.1],...u},c)=>{let h=i.useRef(null);i.useImperativeHandle(c,()=>h.current,[]);let d=i.useRef(1e4*Math.random());return(0,n.C)(e=>{var i,n;if(!t||0===r)return;let u=d.current+e.clock.getElapsedTime();h.current.rotation.x=Math.cos(u/4*r)/8*s,h.current.rotation.y=Math.sin(u/4*r)/8*s,h.current.rotation.z=Math.sin(u/4*r)/20*s;let c=Math.sin(u/4*r)/10;c=a.MathUtils.mapLinear(c,-.1,.1,null!==(i=null==l?void 0:l[0])&&void 0!==i?i:-.1,null!==(n=null==l?void 0:l[1])&&void 0!==n?n:.1),h.current.position.y=c*o,h.current.updateMatrix()}),i.createElement("group",u,i.createElement("group",{ref:h,matrixAutoUpdate:!1},e))})},2325:function(e,t,r){let i,n;r.d(t,{V:function(){return w}});var a=r(2988),s=r(2265),o=r(4040),l=r(7776),u=r(5238);let c=new l.Vector3,h=new l.Vector3,d=new l.Vector3,f=new l.Vector2;function p(e,t,r){let i=c.setFromMatrixPosition(e.matrixWorld);i.project(t);let n=r.width/2,a=r.height/2;return[i.x*n+n,-(i.y*a)+a]}let m=e=>1e-10>Math.abs(e)?0:e;function v(e,t,r=""){let i="matrix3d(";for(let r=0;16!==r;r++)i+=m(t[r]*e.elements[r])+(15!==r?",":")");return r+i}let g=(i=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>v(e,i)),y=(n=e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1],(e,t)=>v(e,n(t),"translate(-50%,-50%)")),w=s.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:n,center:v,fullscreen:w,portal:b,distanceFactor:_,sprite:x=!1,transform:M=!1,occlude:S,onOcclude:E,castShadow:T,receiveShadow:A,material:P,geometry:k,zIndexRange:C=[16777271,0],calculatePosition:I=p,as:U="div",wrapperClass:O,pointerEvents:R="auto",...D},F)=>{let{gl:L,camera:V,scene:j,size:z,raycaster:B,events:H,viewport:N}=(0,u.A)(),[W]=s.useState(()=>document.createElement(U)),$=s.useRef(),q=s.useRef(null),G=s.useRef(0),X=s.useRef([0,0]),Y=s.useRef(null),K=s.useRef(null),Z=(null==b?void 0:b.current)||H.connected||L.domElement.parentNode,Q=s.useRef(null),J=s.useRef(!1),ee=s.useMemo(()=>{var e;return S&&"blending"!==S||Array.isArray(S)&&S.length&&(e=S[0])&&"object"==typeof e&&"current"in e},[S]);s.useLayoutEffect(()=>{let e=L.domElement;S&&"blending"===S?(e.style.zIndex=`${Math.floor(C[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)},[S]),s.useLayoutEffect(()=>{if(q.current){let e=$.current=o.createRoot(W);if(j.updateMatrixWorld(),M)W.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{let e=I(q.current,V,z);W.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return Z&&(n?Z.prepend(W):Z.appendChild(W)),()=>{Z&&Z.removeChild(W),e.unmount()}}},[Z,M]),s.useLayoutEffect(()=>{O&&(W.className=O)},[O]);let et=s.useMemo(()=>M?{position:"absolute",top:0,left:0,width:z.width,height:z.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:v?"translate3d(-50%,-50%,0)":"none",...w&&{top:-z.height/2,left:-z.width/2,width:z.width,height:z.height},...r},[r,v,w,z,M]),er=s.useMemo(()=>({position:"absolute",pointerEvents:R}),[R]);s.useLayoutEffect(()=>{var t,n;J.current=!1,M?null==(t=$.current)||t.render(s.createElement("div",{ref:Y,style:et},s.createElement("div",{ref:K,style:er},s.createElement("div",{ref:F,className:i,style:r,children:e})))):null==(n=$.current)||n.render(s.createElement("div",{ref:F,style:et,className:i,children:e}))});let ei=s.useRef(!0);(0,u.C)(e=>{if(q.current){V.updateMatrixWorld(),q.current.updateWorldMatrix(!0,!1);let e=M?X.current:I(q.current,V,z);if(M||Math.abs(G.current-V.zoom)>t||Math.abs(X.current[0]-e[0])>t||Math.abs(X.current[1]-e[1])>t){let t=function(e,t){let r=c.setFromMatrixPosition(e.matrixWorld),i=h.setFromMatrixPosition(t.matrixWorld),n=r.sub(i),a=t.getWorldDirection(d);return n.angleTo(a)>Math.PI/2}(q.current,V),r=!1;ee&&(Array.isArray(S)?r=S.map(e=>e.current):"blending"!==S&&(r=[j]));let i=ei.current;if(r){let e=function(e,t,r,i){let n=c.setFromMatrixPosition(e.matrixWorld),a=n.clone();a.project(t),f.set(a.x,a.y),r.setFromCamera(f,t);let s=r.intersectObjects(i,!0);if(s.length){let e=s[0].distance;return n.distanceTo(r.ray.origin)<e}return!0}(q.current,V,B,r);ei.current=e&&!t}else ei.current=!t;i!==ei.current&&(E?E(!ei.current):W.style.display=ei.current?"block":"none");let n=Math.floor(C[0]/2),a=S?ee?[C[0],n]:[n-1,0]:C;if(W.style.zIndex=`${function(e,t,r){if(t instanceof l.PerspectiveCamera||t instanceof l.OrthographicCamera){let i=c.setFromMatrixPosition(e.matrixWorld),n=h.setFromMatrixPosition(t.matrixWorld),a=i.distanceTo(n),s=(r[1]-r[0])/(t.far-t.near),o=r[1]-s*t.far;return Math.round(s*a+o)}}(q.current,V,a)}`,M){let[e,t]=[z.width/2,z.height/2],r=V.projectionMatrix.elements[5]*t,{isOrthographicCamera:i,top:n,left:a,bottom:s,right:o}=V,l=g(V.matrixWorldInverse),u=i?`scale(${r})translate(${m(-(o+a)/2)}px,${m((n+s)/2)}px)`:`translateZ(${r}px)`,c=q.current.matrixWorld;x&&((c=V.matrixWorldInverse.clone().transpose().copyPosition(c).scale(q.current.scale)).elements[3]=c.elements[7]=c.elements[11]=0,c.elements[15]=1),W.style.width=z.width+"px",W.style.height=z.height+"px",W.style.perspective=i?"":`${r}px`,Y.current&&K.current&&(Y.current.style.transform=`${u}${l}translate(${e}px,${t}px)`,K.current.style.transform=y(c,1/((_||10)/400)))}else{let t=void 0===_?1:function(e,t){if(t instanceof l.OrthographicCamera)return t.zoom;if(!(t instanceof l.PerspectiveCamera))return 1;{let r=c.setFromMatrixPosition(e.matrixWorld),i=h.setFromMatrixPosition(t.matrixWorld);return 1/(2*Math.tan(t.fov*Math.PI/180/2)*r.distanceTo(i))}}(q.current,V)*_;W.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}X.current=e,G.current=V.zoom}}if(!ee&&Q.current&&!J.current){if(M){if(Y.current){let e=Y.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){let{isOrthographicCamera:t}=V;if(t||k)D.scale&&(Array.isArray(D.scale)?D.scale instanceof l.Vector3?Q.current.scale.copy(D.scale.clone().divideScalar(1)):Q.current.scale.set(1/D.scale[0],1/D.scale[1],1/D.scale[2]):Q.current.scale.setScalar(1/D.scale));else{let t=(_||10)/400,r=e.clientWidth*t,i=e.clientHeight*t;Q.current.scale.set(r,i,1)}J.current=!0}}}else{let t=W.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){let e=1/N.factor,r=t.clientWidth*e,i=t.clientHeight*e;Q.current.scale.set(r,i,1),J.current=!0}Q.current.lookAt(e.camera.position)}}});let en=s.useMemo(()=>({vertexShader:M?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[M]);return s.createElement("group",(0,a.Z)({},D,{ref:q}),S&&!ee&&s.createElement("mesh",{castShadow:T,receiveShadow:A,ref:Q},k||s.createElement("planeGeometry",null),P||s.createElement("shaderMaterial",{side:l.DoubleSide,vertexShader:en.vertexShader,fragmentShader:en.fragmentShader})))})},1789:function(e,t,r){let i,n,a,s;r.d(t,{N:function(){return ii}});var o,l,u=r(2988),c=r(2265),h=r(7776),d=r(5238);let f=k(),p=e=>E(e,f),m=k();p.write=e=>E(e,m);let v=k();p.onStart=e=>E(e,v);let g=k();p.onFrame=e=>E(e,g);let y=k();p.onFinish=e=>E(e,y);let w=[];p.setTimeout=(e,t)=>{let r=p.now()+t,i=()=>{let e=w.findIndex(e=>e.cancel==i);~e&&w.splice(e,1),M-=~e?1:0},n={time:r,handler:e,cancel:i};return w.splice(b(r),0,n),M+=1,T(),n};let b=e=>~(~w.findIndex(t=>t.time>e)||~w.length);p.cancel=e=>{v.delete(e),g.delete(e),y.delete(e),f.delete(e),m.delete(e)},p.sync=e=>{S=!0,p.batchedUpdates(e),S=!1},p.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function i(...e){t=e,p.onStart(r)}return i.handler=e,i.cancel=()=>{v.delete(r),t=null},i};let _="undefined"!=typeof window?window.requestAnimationFrame:()=>{};p.use=e=>_=e,p.now="undefined"!=typeof performance?()=>performance.now():Date.now,p.batchedUpdates=e=>e(),p.catch=console.error,p.frameLoop="always",p.advance=()=>{"demand"!==p.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):P()};let x=-1,M=0,S=!1;function E(e,t){S?(t.delete(e),e(0)):(t.add(e),T())}function T(){x<0&&(x=0,"demand"!==p.frameLoop&&_(A))}function A(){~x&&(_(A),p.batchedUpdates(P))}function P(){let e=x,t=b(x=p.now());if(t&&(C(w.splice(0,t),e=>e.handler()),M-=t),!M){x=-1;return}v.flush(),f.flush(e?Math.min(64,x-e):16.667),g.flush(),m.flush(),y.flush()}function k(){let e=new Set,t=e;return{add(r){M+=t!=e||e.has(r)?0:1,e.add(r)},delete:r=>(M-=t==e&&e.has(r)?1:0,e.delete(r)),flush(r){t.size&&(e=new Set,M-=t.size,C(t,t=>t(r)&&e.add(t)),M+=e.size,t=e)}}}function C(e,t){e.forEach(e=>{try{t(e)}catch(e){p.catch(e)}})}function I(){}let U=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),O={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};function R(e,t){if(O.arr(e)){if(!O.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}let D=(e,t)=>e.forEach(t);function F(e,t,r){if(O.arr(e)){for(let i=0;i<e.length;i++)t.call(r,e[i],`${i}`);return}for(let i in e)e.hasOwnProperty(i)&&t.call(r,e[i],i)}let L=e=>O.und(e)?[]:O.arr(e)?e:[e];function V(e,t){if(e.size){let r=Array.from(e);e.clear(),D(r,t)}}let j=(e,...t)=>V(e,e=>e(...t)),z=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),B=null,H=!1,N=I;var W=Object.freeze({__proto__:null,get createStringInterpolator(){return i},get to(){return n},get colors(){return B},get skipAnimation(){return H},get willAdvance(){return N},assign:e=>{e.to&&(n=e.to),e.now&&(p.now=e.now),void 0!==e.colors&&(B=e.colors),null!=e.skipAnimation&&(H=e.skipAnimation),e.createStringInterpolator&&(i=e.createStringInterpolator),e.requestAnimationFrame&&p.use(e.requestAnimationFrame),e.batchedUpdates&&(p.batchedUpdates=e.batchedUpdates),e.willAdvance&&(N=e.willAdvance),e.frameLoop&&(p.frameLoop=e.frameLoop)}});let $=new Set,q=[],G=[],X=0,Y={get idle(){return!$.size&&!q.length},start(e){X>e.priority?($.add(e),p.onStart(K)):(Z(e),p(J))},advance:J,sort(e){if(X)p.onFrame(()=>Y.sort(e));else{let t=q.indexOf(e);~t&&(q.splice(t,1),Q(e))}},clear(){q=[],$.clear()}};function K(){$.forEach(Z),$.clear(),p(J)}function Z(e){q.includes(e)||Q(e)}function Q(e){q.splice(function(e,t){let r=e.findIndex(t);return r<0?e.length:r}(q,t=>t.priority>e.priority),0,e)}function J(e){let t=G;for(let r=0;r<q.length;r++){let i=q[r];X=i.priority,i.idle||(N(i),i.advance(e),i.idle||t.push(i))}return X=0,(G=q).length=0,(q=t).length>0}let ee="[-+]?\\d*\\.?\\d+",et=ee+"%";function er(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}let ei=RegExp("rgb"+er(ee,ee,ee)),en=RegExp("rgba"+er(ee,ee,ee,ee)),ea=RegExp("hsl"+er(ee,et,et)),es=RegExp("hsla"+er(ee,et,et,ee)),eo=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,el=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,eu=/^#([0-9a-fA-F]{6})$/,ec=/^#([0-9a-fA-F]{8})$/;function eh(e,t,r){return(r<0&&(r+=1),r>1&&(r-=1),r<1/6)?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function ed(e,t,r){let i=r<.5?r*(1+t):r+t-r*t,n=2*r-i;return Math.round(255*eh(n,i,e+1/3))<<24|Math.round(255*eh(n,i,e))<<16|Math.round(255*eh(n,i,e-1/3))<<8}function ef(e){let t=parseInt(e,10);return t<0?0:t>255?255:t}function ep(e){return(parseFloat(e)%360+360)%360/360}function em(e){let t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function ev(e){let t=parseFloat(e);return t<0?0:t>100?1:t/100}function eg(e){let t;let r="number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=eu.exec(e))?parseInt(t[1]+"ff",16)>>>0:B&&void 0!==B[e]?B[e]:(t=ei.exec(e))?(ef(t[1])<<24|ef(t[2])<<16|ef(t[3])<<8|255)>>>0:(t=en.exec(e))?(ef(t[1])<<24|ef(t[2])<<16|ef(t[3])<<8|em(t[4]))>>>0:(t=eo.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=ec.exec(e))?parseInt(t[1],16)>>>0:(t=el.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=ea.exec(e))?(255|ed(ep(t[1]),ev(t[2]),ev(t[3])))>>>0:(t=es.exec(e))?(ed(ep(t[1]),ev(t[2]),ev(t[3]))|em(t[4]))>>>0:null;if(null===r)return e;let i=(4278190080&(r=r||0))>>>24,n=(16711680&r)>>>16,a=(65280&r)>>>8,s=(255&r)/255;return`rgba(${i}, ${n}, ${a}, ${s})`}let ey=(e,t,r)=>{if(O.fun(e))return e;if(O.arr(e))return ey({range:e,output:t,extrapolate:r});if(O.str(e.output[0]))return i(e);let n=e.output,a=e.range||[0,1],s=e.extrapolateLeft||e.extrapolate||"extend",o=e.extrapolateRight||e.extrapolate||"extend",l=e.easing||(e=>e);return t=>{let r=function(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}(t,a);return function(e,t,r,i,n,a,s,o,l){let u=l?l(e):e;if(u<t){if("identity"===s)return u;"clamp"===s&&(u=t)}if(u>r){if("identity"===o)return u;"clamp"===o&&(u=r)}return i===n?i:t===r?e<=t?i:n:(t===-1/0?u=-u:r===1/0?u-=t:u=(u-t)/(r-t),u=a(u),i===-1/0?u=-u:n===1/0?u+=i:u=u*(n-i)+i,u)}(t,a[r],a[r+1],n[r],n[r+1],l,s,o,e.map)}};function ew(){return(ew=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}let eb=Symbol.for("FluidValue.get"),e_=Symbol.for("FluidValue.observers"),ex=e=>!!(e&&e[eb]),eM=e=>e&&e[eb]?e[eb]():e,eS=e=>e[e_]||null;function eE(e,t){let r=e[e_];r&&r.forEach(e=>{e.eventObserved?e.eventObserved(t):e(t)})}class eT{constructor(e){if(this[eb]=void 0,this[e_]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");eA(this,e)}}let eA=(e,t)=>eC(e,eb,t);function eP(e,t){if(e[eb]){let r=e[e_];r||eC(e,e_,r=new Set),!r.has(t)&&(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function ek(e,t){let r=e[e_];if(r&&r.has(t)){let i=r.size-1;i?r.delete(t):e[e_]=null,e.observerRemoved&&e.observerRemoved(i,t)}}let eC=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),eI=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,eU=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,eO=RegExp(`(${eI.source})(%|[a-z]+)`,"i"),eR=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,eD=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,eF=e=>{let[t,r]=eL(e);if(!t||z())return e;let i=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(i)return i.trim();if(r&&r.startsWith("--")){let e=window.getComputedStyle(document.documentElement).getPropertyValue(r);if(e)return e}else if(r&&eD.test(r))return eF(r);else if(r)return r;return e},eL=e=>{let t=eD.exec(e);if(!t)return[,];let[,r,i]=t;return[r,i]},eV=(e,t,r,i,n)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(i)}, ${n})`,ej=e=>{a||(a=B?RegExp(`(${Object.keys(B).join("|")})(?!\\w)`,"g"):/^\b$/);let t=e.output.map(e=>eM(e).replace(eD,eF).replace(eU,eg).replace(a,eg)),r=t.map(e=>e.match(eI).map(Number)),i=r[0].map((e,t)=>r.map(e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})).map(t=>ey(ew({},e,{output:t})));return e=>{var r;let n=!eO.test(t[0])&&(null==(r=t.find(e=>eO.test(e)))?void 0:r.replace(eI,"")),a=0;return t[0].replace(eI,()=>`${i[a++](e)}${n||""}`).replace(eR,eV)}},ez="react-spring: ",eB=e=>{let t=!1;if("function"!=typeof e)throw TypeError(`${ez}once requires a function parameter`);return(...r)=>{t||(e(...r),t=!0)}},eH=eB(console.warn),eN=eB(console.warn);function eW(e){return O.str(e)&&("#"==e[0]||/\d/.test(e)||!z()&&eD.test(e)||e in(B||{}))}new WeakMap,new WeakMap,new WeakMap,new WeakMap;let e$=z()?c.useEffect:c.useLayoutEffect,eq=()=>{let e=(0,c.useRef)(!1);return e$(()=>(e.current=!0,()=>{e.current=!1}),[]),e};function eG(){let e=(0,c.useState)()[1],t=eq();return()=>{t.current&&e(Math.random())}}let eX=e=>(0,c.useEffect)(e,eY),eY=[];function eK(e){let t=(0,c.useRef)();return(0,c.useEffect)(()=>{t.current=e}),t.current}let eZ=Symbol.for("Animated:node"),eQ=e=>!!e&&e[eZ]===e,eJ=e=>e&&e[eZ],e0=(e,t)=>U(e,eZ,t),e1=e=>e&&e[eZ]&&e[eZ].getPayload();class e2{constructor(){this.payload=void 0,e0(this,this)}getPayload(){return this.payload||[]}}class e3 extends e2{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,O.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new e3(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return O.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){let{done:e}=this;this.done=!1,O.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class e5 extends e3{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=ey({output:[e,e]})}static create(e){return new e5(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(O.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=ey({output:[this.getValue(),e]})),this._value=0,super.reset()}}let e4={dependencies:null};class e6 extends e2{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){let t={};return F(this.source,(r,i)=>{eQ(r)?t[i]=r.getValue(e):ex(r)?t[i]=eM(r):e||(t[i]=r)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&D(this.payload,e=>e.reset())}_makePayload(e){if(e){let t=new Set;return F(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){e4.dependencies&&ex(e)&&e4.dependencies.add(e);let t=e1(e);t&&D(t,e=>this.add(e))}}class e8 extends e6{constructor(e){super(e)}static create(e){return new e8(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){let t=this.getPayload();return e.length==t.length?t.map((t,r)=>t.setValue(e[r])).some(Boolean):(super.setValue(e.map(e7)),!0)}}function e7(e){return(eW(e)?e5:e3).create(e)}function e9(e){let t=eJ(e);return t?t.constructor:O.arr(e)?e8:eW(e)?e5:e3}function te(){return(te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}let tt=(e,t)=>{let r=!O.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,c.forwardRef)((i,n)=>{let a=(0,c.useRef)(null),s=r&&(0,c.useCallback)(e=>{a.current=(n&&(O.fun(n)?n(e):n.current=e),e)},[n]),[o,l]=function(e,t){let r=new Set;return e4.dependencies=r,e.style&&(e=te({},e,{style:t.createAnimatedStyle(e.style)})),e=new e6(e),e4.dependencies=null,[e,r]}(i,t),u=eG(),h=()=>{let e=a.current;(!r||e)&&!1===(!!e&&t.applyAnimatedValues(e,o.getValue(!0)))&&u()},d=new tr(h,l),f=(0,c.useRef)();e$(()=>(f.current=d,D(l,e=>eP(e,d)),()=>{f.current&&(D(f.current.deps,e=>ek(e,f.current)),p.cancel(f.current.update))})),(0,c.useEffect)(h,[]),eX(()=>()=>{let e=f.current;D(e.deps,t=>ek(t,e))});let m=t.getComponentProps(o.getValue());return c.createElement(e,te({},m,{ref:s}))})};class tr{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&p.write(this.update)}}let ti=Symbol.for("AnimatedComponent"),tn=e=>O.str(e)?e:e&&O.str(e.displayName)?e.displayName:O.fun(e)&&e.name||null;function ta(){return(ta=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ts(e,...t){return O.fun(e)?e(...t):e}let to=(e,t)=>!0===e||!!(t&&e&&(O.fun(e)?e(t):L(e).includes(t))),tl=(e,t)=>O.obj(e)?t&&e[t]:e,tu=(e,t)=>!0===e.default?e[t]:e.default?e.default[t]:void 0,tc=e=>e,th=(e,t=tc)=>{let r=td;e.default&&!0!==e.default&&(r=Object.keys(e=e.default));let i={};for(let n of r){let r=t(e[n],n);O.und(r)||(i[n]=r)}return i},td=["config","onProps","onStart","onChange","onPause","onResume","onRest"],tf={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function tp(e){let t=function(e){let t={},r=0;if(F(e,(e,i)=>{!tf[i]&&(t[i]=e,r++)}),r)return t}(e);if(t){let r={to:t};return F(e,(e,i)=>i in t||(r[i]=e)),r}return ta({},e)}function tm(e){return e=eM(e),O.arr(e)?e.map(tm):eW(e)?W.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function tv(e){return O.fun(e)||O.arr(e)&&O.obj(e[0])}let tg=ta({},{tension:170,friction:26},{mass:1,damping:1,easing:e=>e,clamp:!1});class ty{constructor(){this.tension=void 0,this.friction=void 0,this.frequency=void 0,this.damping=void 0,this.mass=void 0,this.velocity=0,this.restVelocity=void 0,this.precision=void 0,this.progress=void 0,this.duration=void 0,this.easing=void 0,this.clamp=void 0,this.bounce=void 0,this.decay=void 0,this.round=void 0,Object.assign(this,tg)}}function tw(e,t){if(O.und(t.decay)){let r=!O.und(t.tension)||!O.und(t.friction);!r&&O.und(t.frequency)&&O.und(t.damping)&&O.und(t.mass)||(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}else e.duration=void 0}let tb=[];class t_{constructor(){this.changed=!1,this.values=tb,this.toValues=null,this.fromValues=tb,this.to=void 0,this.from=void 0,this.config=new ty,this.immediate=!1}}function tx(e,{key:t,props:r,defaultProps:i,state:n,actions:a}){return new Promise((s,o)=>{var l;let u,c;let h=to(null!=(l=r.cancel)?l:null==i?void 0:i.cancel,t);if(h)m();else{O.und(r.pause)||(n.paused=to(r.pause,t));let e=null==i?void 0:i.pause;!0!==e&&(e=n.paused||to(e,t)),u=ts(r.delay||0,t),e?(n.resumeQueue.add(f),a.pause()):(a.resume(),f())}function d(){n.resumeQueue.add(f),n.timeouts.delete(c),c.cancel(),u=c.time-p.now()}function f(){u>0&&!W.skipAnimation?(n.delayed=!0,c=p.setTimeout(m,u),n.pauseQueue.add(d),n.timeouts.add(c)):m()}function m(){n.delayed&&(n.delayed=!1),n.pauseQueue.delete(d),n.timeouts.delete(c),e<=(n.cancelId||0)&&(h=!0);try{a.start(ta({},r,{callId:e,cancel:h}),s)}catch(e){o(e)}}})}let tM=(e,t)=>1==t.length?t[0]:t.some(e=>e.cancelled)?tT(e.get()):t.every(e=>e.noop)?tS(e.get()):tE(e.get(),t.every(e=>e.finished)),tS=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),tE=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),tT=e=>({value:e,cancelled:!0,finished:!1});function tA(e,t,r,i){let{callId:n,parentId:a,onRest:s}=t,{asyncTo:o,promise:l}=r;return a||e!==o||t.reset?r.promise=(async()=>{let u,c,h;r.asyncId=n,r.asyncTo=e;let d=th(t,(e,t)=>"onRest"===t?void 0:e),f=new Promise((e,t)=>(u=e,c=t)),m=e=>{let t=n<=(r.cancelId||0)&&tT(i)||n!==r.asyncId&&tE(i,!1);if(t)throw e.result=t,c(e),e},v=(e,t)=>{let a=new tk,s=new tC;return(async()=>{if(W.skipAnimation)throw tP(r),s.result=tE(i,!1),c(s),s;m(a);let o=O.obj(e)?ta({},e):ta({},t,{to:e});o.parentId=n,F(d,(e,t)=>{O.und(o[t])&&(o[t]=e)});let l=await i.start(o);return m(a),r.paused&&await new Promise(e=>{r.resumeQueue.add(e)}),l})()};if(W.skipAnimation)return tP(r),tE(i,!1);try{let t;t=O.arr(e)?(async e=>{for(let t of e)await v(t)})(e):Promise.resolve(e(v,i.stop.bind(i))),await Promise.all([t.then(u),f]),h=tE(i.get(),!0,!1)}catch(e){if(e instanceof tk)h=e.result;else if(e instanceof tC)h=e.result;else throw e}finally{n==r.asyncId&&(r.asyncId=a,r.asyncTo=a?o:void 0,r.promise=a?l:void 0)}return O.fun(s)&&p.batchedUpdates(()=>{s(h,i,i.item)}),h})():l}function tP(e,t){V(e.timeouts,e=>e.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}class tk extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise."),this.result=void 0}}class tC extends Error{constructor(){super("SkipAnimationSignal"),this.result=void 0}}let tI=e=>e instanceof tO,tU=1;class tO extends eT{constructor(...e){super(...e),this.id=tU++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){let e=eJ(this);return e&&e.getValue()}to(...e){return W.to(this,e)}interpolate(...e){return eH(`${ez}The "interpolate" function is deprecated in v9 (use "to" instead)`),W.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){eE(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||Y.sort(this),eE(this,{type:"priority",parent:this,priority:e})}}let tR=Symbol.for("SpringPhase"),tD=e=>(1&e[tR])>0,tF=e=>(2&e[tR])>0,tL=e=>(4&e[tR])>0,tV=(e,t)=>t?e[tR]|=3:e[tR]&=-3,tj=(e,t)=>t?e[tR]|=4:e[tR]&=-5;class tz extends tO{constructor(e,t){if(super(),this.key=void 0,this.animation=new t_,this.queue=void 0,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!O.und(e)||!O.und(t)){let r=O.obj(e)?ta({},e):ta({},t,{from:e});O.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(tF(this)||this._state.asyncTo)||tL(this)}get goal(){return eM(this.animation.to)}get velocity(){let e=eJ(this);return e instanceof e3?e.lastVelocity||0:e.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return tD(this)}get isAnimating(){return tF(this)}get isPaused(){return tL(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1,i=this.animation,{config:n,toValues:a}=i,s=e1(i.to);!s&&ex(i.to)&&(a=L(eM(i.to))),i.values.forEach((o,l)=>{if(o.done)return;let u=o.constructor==e5?1:s?s[l].lastPosition:a[l],c=i.immediate,h=u;if(!c){let t;if(h=o.lastPosition,n.tension<=0){o.done=!0;return}let r=o.elapsedTime+=e,a=i.fromValues[l],s=null!=o.v0?o.v0:o.v0=O.arr(n.velocity)?n.velocity[l]:n.velocity,d=n.precision||(a==u?.005:Math.min(1,.001*Math.abs(u-a)));if(O.und(n.duration)){if(n.decay){let e=!0===n.decay?.998:n.decay,i=Math.exp(-(1-e)*r);h=a+s/(1-e)*(1-i),c=Math.abs(o.lastPosition-h)<=d,t=s*i}else{t=null==o.lastVelocity?s:o.lastVelocity;let r=n.restVelocity||d/10,i=n.clamp?0:n.bounce,l=!O.und(i),f=a==u?o.v0>0:a<u,p=Math.ceil(e/1);for(let e=0;e<p&&!(!(Math.abs(t)>r)&&(c=Math.abs(u-h)<=d));++e){l&&(h==u||h>u==f)&&(t=-t*i,h=u);let e=(-(1e-6*n.tension)*(h-u)+-(.001*n.friction)*t)/n.mass;t+=1*e,h+=1*t}}}else{let i=1;n.duration>0&&(this._memoizedDuration!==n.duration&&(this._memoizedDuration=n.duration,o.durationProgress>0&&(o.elapsedTime=n.duration*o.durationProgress,r=o.elapsedTime+=e)),i=(i=(n.progress||0)+r/this._memoizedDuration)>1?1:i<0?0:i,o.durationProgress=i),t=((h=a+n.easing(i)*(u-a))-o.lastPosition)/e,c=1==i}o.lastVelocity=t,Number.isNaN(h)&&(console.warn("Got NaN while animating:",this),c=!0)}s&&!s[l].done&&(c=!1),c?o.done=!0:t=!1,o.setValue(h,n.round)&&(r=!0)});let o=eJ(this),l=o.getValue();if(t){let e=eM(i.to);(l!==e||r)&&!n.decay?(o.setValue(e),this._onChange(e)):r&&n.decay&&this._onChange(l),this._stop()}else r&&this._onChange(l)}set(e){return p.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(tF(this)){let{to:e,config:t}=this.animation;p.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return O.und(e)?(r=this.queue||[],this.queue=[]):r=[O.obj(e)?e:ta({},t,{to:e})],Promise.all(r.map(e=>this._update(e))).then(e=>tM(this,e))}stop(e){let{to:t}=this.animation;return this._focus(this.get()),tP(this._state,e&&this._lastCallId),p.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){"change"==e.type?this._start():"priority"==e.type&&(this.priority=e.priority+1)}_prepareNode(e){let t=this.key||"",{to:r,from:i}=e;(null==(r=O.obj(r)?r[t]:r)||tv(r))&&(r=void 0),null==(i=O.obj(i)?i[t]:i)&&(i=void 0);let n={to:r,from:i};return tD(this)||(e.reverse&&([r,i]=[i,r]),i=eM(i),O.und(i)?eJ(this)||this._set(r):this._set(i)),n}_update(e,t){let r=ta({},e),{key:i,defaultProps:n}=this;r.default&&Object.assign(n,th(r,(e,t)=>/^on/.test(t)?tl(e,i):e)),tq(this,r,"onProps"),tG(this,"onProps",r,this);let a=this._prepareNode(r);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");let s=this._state;return tx(++this._lastCallId,{key:i,props:r,defaultProps:n,state:s,actions:{pause:()=>{tL(this)||(tj(this,!0),j(s.pauseQueue),tG(this,"onPause",tE(this,tB(this,this.animation.to)),this))},resume:()=>{tL(this)&&(tj(this,!1),tF(this)&&this._resume(),j(s.resumeQueue),tG(this,"onResume",tE(this,tB(this,this.animation.to)),this))},start:this._merge.bind(this,a)}}).then(e=>{if(r.loop&&e.finished&&!(t&&e.noop)){let e=tH(r);if(e)return this._update(e,!0)}return e})}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(tT(this));let i=!O.und(e.to),n=!O.und(e.from);if(i||n){if(!(t.callId>this._lastToId))return r(tT(this));this._lastToId=t.callId}let{key:a,defaultProps:s,animation:o}=this,{to:l,from:u}=o,{to:c=l,from:h=u}=e;n&&!i&&(!t.default||O.und(c))&&(c=h),t.reverse&&([c,h]=[h,c]);let d=!R(h,u);d&&(o.from=h),h=eM(h);let f=!R(c,l);f&&this._focus(c);let m=tv(t.to),{config:v}=o,{decay:g,velocity:y}=v;(i||n)&&(v.velocity=0),t.config&&!m&&function(e,t,r){for(let i in r&&(tw(r=ta({},r),t),t=ta({},r,t)),tw(e,t),Object.assign(e,t),tg)null==e[i]&&(e[i]=tg[i]);let{mass:i,frequency:n,damping:a}=e;O.und(n)||(n<.01&&(n=.01),a<0&&(a=0),e.tension=Math.pow(2*Math.PI/n,2)*i,e.friction=4*Math.PI*a*i/n)}(v,ts(t.config,a),t.config!==s.config?ts(s.config,a):void 0);let w=eJ(this);if(!w||O.und(c))return r(tE(this,!0));let b=O.und(t.reset)?n&&!t.default:!O.und(h)&&to(t.reset,a),_=b?h:this.get(),x=tm(c),M=O.num(x)||O.arr(x)||eW(x),S=!m&&(!M||to(s.immediate||t.immediate,a));if(f){let e=e9(c);if(e!==w.constructor){if(S)w=this._set(x);else throw Error(`Cannot animate between ${w.constructor.name} and ${e.name}, as the "to" prop suggests`)}}let E=w.constructor,T=ex(c),A=!1;if(!T){let e=b||!tD(this)&&d;(f||e)&&(T=!(A=R(tm(_),x))),(R(o.immediate,S)||S)&&R(v.decay,g)&&R(v.velocity,y)||(T=!0)}if(A&&tF(this)&&(o.changed&&!b?T=!0:T||this._stop(l)),!m&&((T||ex(l))&&(o.values=w.getPayload(),o.toValues=ex(c)?null:E==e5?[1]:L(x)),o.immediate==S||(o.immediate=S,S||b||this._set(l)),T)){let{onRest:e}=o;D(t$,e=>tq(this,t,e));let i=tE(this,tB(this,l));j(this._pendingCalls,i),this._pendingCalls.add(r),o.changed&&p.batchedUpdates(()=>{o.changed=!b,null==e||e(i,this),b?ts(s.onRest,i):null==o.onStart||o.onStart(i,this)})}b&&this._set(_),m?r(tA(t.to,t,this._state,this)):T?this._start():tF(this)&&!f?this._pendingCalls.add(r):r(tS(_))}_focus(e){let t=this.animation;e!==t.to&&(eS(this)&&this._detach(),t.to=e,eS(this)&&this._attach())}_attach(){let e=0,{to:t}=this.animation;ex(t)&&(eP(t,this),tI(t)&&(e=t.priority+1)),this.priority=e}_detach(){let{to:e}=this.animation;ex(e)&&ek(e,this)}_set(e,t=!0){let r=eM(e);if(!O.und(r)){let e=eJ(this);if(!e||!R(r,e.getValue())){let i=e9(r);e&&e.constructor==i?e.setValue(r):e0(this,i.create(r)),e&&p.batchedUpdates(()=>{this._onChange(r,t)})}}return eJ(this)}_onStart(){let e=this.animation;e.changed||(e.changed=!0,tG(this,"onStart",tE(this,tB(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),ts(this.animation.onChange,e,this)),ts(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){let e=this.animation;eJ(this).reset(eM(e.to)),e.immediate||(e.fromValues=e.values.map(e=>e.lastPosition)),tF(this)||(tV(this,!0),tL(this)||this._resume())}_resume(){W.skipAnimation?this.finish():Y.start(this)}_stop(e,t){if(tF(this)){tV(this,!1);let r=this.animation;D(r.values,e=>{e.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),eE(this,{type:"idle",parent:this});let i=t?tT(this.get()):tE(this.get(),tB(this,null!=e?e:r.to));j(this._pendingCalls,i),r.changed&&(r.changed=!1,tG(this,"onRest",i,this))}}}function tB(e,t){let r=tm(t);return R(tm(e.get()),r)}function tH(e,t=e.loop,r=e.to){let i=ts(t);if(i){let n=!0!==i&&tp(i),a=(n||e).reverse,s=!n||n.reset;return tN(ta({},e,{loop:t,default:!1,pause:void 0,to:!a||tv(r)?r:void 0,from:s?e.from:void 0,reset:s},n))}}function tN(e){let{to:t,from:r}=e=tp(e),i=new Set;return O.obj(t)&&tW(t,i),O.obj(r)&&tW(r,i),e.keys=i.size?Array.from(i):null,e}function tW(e,t){F(e,(e,r)=>null!=e&&t.add(r))}let t$=["onStart","onRest","onChange","onPause","onResume"];function tq(e,t,r){e.animation[r]=t[r]!==tu(t,r)?tl(t[r],e.key):void 0}function tG(e,t,...r){var i,n,a,s;null==(i=(n=e.animation)[t])||i.call(n,...r),null==(a=(s=e.defaultProps)[t])||a.call(s,...r)}let tX=["onStart","onChange","onRest"],tY=1;class tK{constructor(e,t){this.id=tY++,this.springs={},this.queue=[],this.ref=void 0,this._flush=void 0,this._initialProps=void 0,this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._item=void 0,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),t&&(this._flush=t),e&&this.start(ta({default:!0},e))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){let e={};return this.each((t,r)=>e[r]=t.get()),e}set(e){for(let t in e){let r=e[t];O.und(r)||this.springs[t].set(r)}}update(e){return e&&this.queue.push(tN(e)),this}start(e){let{queue:t}=this;return(e?t=L(e).map(tN):this.queue=[],this._flush)?this._flush(this,t):(t3(this,t),tZ(this,t))}stop(e,t){if(!!e!==e&&(t=e),t){let r=this.springs;D(L(t),t=>r[t].stop(!!e))}else tP(this._state,this._lastAsyncId),this.each(t=>t.stop(!!e));return this}pause(e){if(O.und(e))this.start({pause:!0});else{let t=this.springs;D(L(e),e=>t[e].pause())}return this}resume(e){if(O.und(e))this.start({pause:!1});else{let t=this.springs;D(L(e),e=>t[e].resume())}return this}each(e){F(this.springs,e)}_onFrame(){let{onStart:e,onChange:t,onRest:r}=this._events,i=this._active.size>0,n=this._changed.size>0;(i&&!this._started||n&&!this._started)&&(this._started=!0,V(e,([e,t])=>{t.value=this.get(),e(t,this,this._item)}));let a=!i&&this._started,s=n||a&&r.size?this.get():null;n&&t.size&&V(t,([e,t])=>{t.value=s,e(t,this,this._item)}),a&&(this._started=!1,V(r,([e,t])=>{t.value=s,e(t,this,this._item)}))}eventObserved(e){if("change"==e.type)this._changed.add(e.parent),e.idle||this._active.add(e.parent);else{if("idle"!=e.type)return;this._active.delete(e.parent)}p.onFrame(this._onFrame)}}function tZ(e,t){return Promise.all(t.map(t=>tQ(e,t))).then(t=>tM(e,t))}async function tQ(e,t,r){let{keys:i,to:n,from:a,loop:s,onRest:o,onResolve:l}=t,u=O.obj(t.default)&&t.default;s&&(t.loop=!1),!1===n&&(t.to=null),!1===a&&(t.from=null);let c=O.arr(n)||O.fun(n)?n:void 0;c?(t.to=void 0,t.onRest=void 0,u&&(u.onRest=void 0)):D(tX,r=>{let i=t[r];if(O.fun(i)){let n=e._events[r];t[r]=({finished:e,cancelled:t})=>{let r=n.get(i);r?(e||(r.finished=!1),t&&(r.cancelled=!0)):n.set(i,{value:null,finished:e||!1,cancelled:t||!1})},u&&(u[r]=t[r])}});let h=e._state;!h.paused===t.pause?(h.paused=t.pause,j(t.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(t.pause=!0);let d=(i||Object.keys(e.springs)).map(r=>e.springs[r].start(t)),f=!0===t.cancel||!0===tu(t,"cancel");(c||f&&h.asyncId)&&d.push(tx(++e._lastAsyncId,{props:t,state:h,actions:{pause:I,resume:I,start(t,r){f?(tP(h,e._lastAsyncId),r(tT(e))):(t.onRest=o,r(tA(c,t,h,e)))}}})),h.paused&&await new Promise(e=>{h.resumeQueue.add(e)});let m=tM(e,await Promise.all(d));if(s&&m.finished&&!(r&&m.noop)){let r=tH(t,s,n);if(r)return t3(e,[r]),tQ(e,r,!0)}return l&&p.batchedUpdates(()=>l(m,e,e.item)),m}function tJ(e,t){let r=ta({},e.springs);return t&&D(L(t),e=>{O.und(e.keys)&&(e=tN(e)),O.obj(e.to)||(e=ta({},e,{to:void 0})),t2(r,e,e=>t1(e))}),t0(e,r),r}function t0(e,t){F(t,(t,r)=>{e.springs[r]||(e.springs[r]=t,eP(t,e))})}function t1(e,t){let r=new tz;return r.key=e,t&&eP(r,t),r}function t2(e,t,r){t.keys&&D(t.keys,i=>{(e[i]||(e[i]=r(i)))._prepareNode(t)})}function t3(e,t){D(t,t=>{t2(e.springs,t,t=>t1(t,e))})}let t5=["children"],t4=e=>{let{children:t}=e,r=function(e,t){if(null==e)return{};var r,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t5),i=(0,c.useContext)(t6),n=r.pause||!!i.pause,a=r.immediate||!!i.immediate;r=function(e,t){let[r]=(0,c.useState)(()=>({inputs:t,result:e()})),i=(0,c.useRef)(),n=i.current,a=n;return a?t&&a.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(t,a.inputs)||(a={inputs:t,result:e()}):a=r,(0,c.useEffect)(()=>{i.current=a,n==r&&(r.inputs=r.result=void 0)},[a]),a.result}(()=>({pause:n,immediate:a}),[n,a]);let{Provider:s}=t6;return c.createElement(s,{value:r},t)},t6=(o={},Object.assign(t4,c.createContext(o)),t4.Provider._context=t4,t4.Consumer._context=t4,t4);t4.Provider=t6.Provider,t4.Consumer=t6.Consumer;let t8=()=>{let e=[],t=function(t){eN(`${ez}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`);let i=[];return D(e,(e,n)=>{if(O.und(t))i.push(e.start());else{let a=r(t,e,n);a&&i.push(e.start(a))}}),i};t.current=e,t.add=function(t){e.includes(t)||e.push(t)},t.delete=function(t){let r=e.indexOf(t);~r&&e.splice(r,1)},t.pause=function(){return D(e,e=>e.pause(...arguments)),this},t.resume=function(){return D(e,e=>e.resume(...arguments)),this},t.set=function(t){D(e,e=>e.set(t))},t.start=function(t){let r=[];return D(e,(e,i)=>{if(O.und(t))r.push(e.start());else{let n=this._getProps(t,e,i);n&&r.push(e.start(n))}}),r},t.stop=function(){return D(e,e=>e.stop(...arguments)),this},t.update=function(t){return D(e,(e,r)=>e.update(this._getProps(t,e,r))),this};let r=function(e,t,r){return O.fun(e)?e(r,t):e};return t._getProps=r,t};(l=s||(s={})).MOUNT="mount",l.ENTER="enter",l.UPDATE="update",l.LEAVE="leave";class t7 extends tO{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=ey(...t);let r=this._get();e0(this,e9(r).create(r))}advance(e){let t=this._get();R(t,this.get())||(eJ(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&re(this._active)&&rt(this)}_get(){let e=O.arr(this.source)?this.source.map(eM):L(eM(this.source));return this.calc(...e)}_start(){this.idle&&!re(this._active)&&(this.idle=!1,D(e1(this),e=>{e.done=!1}),W.skipAnimation?(p.batchedUpdates(()=>this.advance()),rt(this)):Y.start(this))}_attach(){let e=1;D(L(this.source),t=>{ex(t)&&eP(t,this),tI(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){D(L(this.source),e=>{ex(e)&&ek(e,this)}),this._active.clear(),rt(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=L(this.source).reduce((e,t)=>Math.max(e,(tI(t)?t.priority:0)+1),0))}}function t9(e){return!1!==e.idle}function re(e){return!e.size||Array.from(e).every(t9)}function rt(e){e.idle||(e.idle=!0,D(e1(e),e=>{e.done=!0}),eE(e,{type:"idle",parent:e}))}W.assign({createStringInterpolator:ej,to:(e,t)=>new t7(e,t)}),Y.advance;let rr=["primitive"].concat(Object.keys(h).filter(e=>/^[A-Z]/.test(e)).map(e=>e[0].toLowerCase()+e.slice(1)));W.assign({createStringInterpolator:ej,colors:{transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},frameLoop:"demand"}),(0,d.n)(()=>{p.advance()});let ri=((e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:r=e=>new e6(e),getComponentProps:i=e=>e}={})=>{let n={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:i},a=e=>{let t=tn(e)||"Anonymous";return(e=O.str(e)?a[e]||(a[e]=tt(e,n)):e[ti]||(e[ti]=tt(e,n))).displayName=`Animated(${t})`,e};return F(e,(t,r)=>{O.arr(e)&&(r=tn(t)),a[r]=a(t)}),{animated:a}})(rr,{applyAnimatedValues:d.j}).animated,rn={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function ra(e,t,r){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*r):e*t*r/(t+r*e)}function rs(e,t,r,i=.15){return 0===i?Math.max(t,Math.min(e,r)):e<t?-ra(t-e,r-t,i)+t:e>r?+ra(e-r,r-t,i)+r:e}function ro(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function ru(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rl(Object(r),!0).forEach(function(t){ro(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rl(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let rc={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function rh(e){return e?e[0].toUpperCase()+e.slice(1):""}let rd=["enter","leave"],rf=["gotpointercapture","lostpointercapture"];function rp(e){return"touches"in e}function rm(e){return rp(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function rv(e){return rp(e)?("touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches)[0]:e}function rg(e,t){try{let r=t.clientX-e.clientX,i=t.clientY-e.clientY,n=(t.clientX+e.clientX)/2,a=(t.clientY+e.clientY)/2;return{angle:-(180*Math.atan2(r,i))/Math.PI,distance:Math.hypot(r,i),origin:[n,a]}}catch(e){}return null}function ry(e,t){let[r,i]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return rg(r,i)}function rw(e){let t=rv(e);return rp(e)?t.identifier:t.pointerId}function rb(e){let t=rv(e);return[t.clientX,t.clientY]}function r_(e){let{deltaX:t,deltaY:r,deltaMode:i}=e;return 1===i?(t*=40,r*=40):2===i&&(t*=800,r*=800),[t,r]}function rx(e,...t){return"function"==typeof e?e(...t):e}function rM(){}function rS(e,t){return Object.assign({},t,e||{})}class rE{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?rx(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:r,shared:i}=this;t.args=this.args;let n=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,function(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:r,altKey:i,metaKey:n,ctrlKey:a}=e;Object.assign(t,{shiftKey:r,altKey:i,metaKey:n,ctrlKey:a})}return t}(e)),i.down=i.pressed=i.buttons%2==1||i.touches>0,n=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);rn.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[a,s]=t._movement,[o,l]=r.threshold,{_step:u,values:c}=t;if(r.hasCustomTransform?(!1===u[0]&&(u[0]=Math.abs(a)>=o&&c[0]),!1===u[1]&&(u[1]=Math.abs(s)>=l&&c[1])):(!1===u[0]&&(u[0]=Math.abs(a)>=o&&Math.sign(a)*o),!1===u[1]&&(u[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==u[0]||!1!==u[1],!t.intentional)return;let h=[0,0];if(r.hasCustomTransform){let[e,t]=c;h[0]=!1!==u[0]?e-u[0]:0,h[1]=!1!==u[1]?t-u[1]:0}else h[0]=!1!==u[0]?a-u[0]:0,h[1]=!1!==u[1]?s-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);let d=t.offset,f=t._active&&!t._blocked||t.active;f&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=rx(r.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));let[p,m]=t.offset,[[v,g],[y,w]]=t._bounds;t.overflow=[p<v?-1:p>g?1:0,m<y?-1:m>w?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let b=t._active&&r.rubberband||[0,0];if(t.offset=function(e,[t,r],[i,n]){let[[a,s],[o,l]]=e;return[rs(t,a,s,i),rs(r,o,l,n)]}(t._bounds,t.offset,b),t.delta=rn.sub(t.offset,d),this.computeMovement(),f&&(!t.last||n>32)){t.delta=rn.sub(t.offset,d);let e=t.delta.map(Math.abs);rn.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&n>0&&(t.velocity=[e[0]/n,e[1]/n],t.timeDelta=n)}}emit(){let e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;let i=this.handler(ru(ru(ru({},t),e),{},{[this.aliasKey]:e.values}));void 0!==i&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class rT extends rE{constructor(...e){super(...e),ro(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=rn.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=rn.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,r=this.config;if(!t.axis&&e){let i="object"==typeof r.axisThreshold?r.axisThreshold[rm(e)]:r.axisThreshold;t.axis=function([e,t],r){let i=Math.abs(e),n=Math.abs(t);return i>n&&i>r?"x":n>i&&n>r?"y":void 0}(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}let rA=e=>e,rP={enabled:(e=!0)=>e,eventOptions:(e,t,r)=>ru(ru({},r.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return rn.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?rn.toVector(e):void 0,transform(e,t,r){let i=e||r.shared.transform;return this.hasCustomTransform=!!i,i||rA},threshold:e=>rn.toVector(e,0)},rk=0,rC=ru(ru({},rP),{},{axis(e,t,{axis:r}){if(this.lockDirection="lock"===r,!this.lockDirection)return r},axisThreshold:(e=rk)=>e,bounds(e={}){if("function"==typeof e)return t=>rC.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:r=1/0,top:i=-1/0,bottom:n=1/0}=e;return[[t,r],[i,n]]}}),rI={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]};class rU extends rT{constructor(...e){super(...e),ro(this,"ingKey","dragging")}reset(){super.reset();let e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){let e=this.state;if(e._bounds instanceof HTMLElement){let t=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),i={left:t.left-r.left+e.offset[0],right:t.right-r.right+e.offset[0],top:t.top-r.top+e.offset[1],bottom:t.bottom-r.bottom+e.offset[1]};e._bounds=rC.bounds(i)}}cancel(){let e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){let t=this.config,r=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;let i=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),i&&i.size>1&&r._pointerActive||(this.start(e),this.setupPointer(e),r._pointerId=rw(e),r._pointerActive=!0,this.computeValues(rb(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==rm(e)?(r._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){let t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){let t=this.state,r=this.config;if(!t._pointerActive)return;let i=rw(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;let n=rb(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=rn.sub(n,t._values),this.computeValues(n)),rn.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!t._preventScroll){if(!t.axis)return;if(t.axis===r.preventScrollAxis||"xy"===r.preventScrollAxis){t._active=!1,this.clean();return}this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(e){}let t=this.state,r=this.config;if(!t._active||!t._pointerActive)return;let i=rw(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);let[n,a]=t._distance;if(t.tap=n<=r.tapsThreshold&&a<=r.tapsThreshold,t.tap&&r.filterTaps)t._force=!0;else{let[e,i]=t._delta,[n,a]=t._movement,[s,o]=r.swipe.velocity,[l,u]=r.swipe.distance,c=r.swipe.duration;if(t.elapsedTime<c){let r=Math.abs(e/t.timeDelta),c=Math.abs(i/t.timeDelta);r>s&&Math.abs(n)>l&&(t.swipe[0]=Math.sign(e)),c>o&&Math.abs(a)>u&&(t.swipe[1]=Math.sign(i))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){let t=this.config,r=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,"persist"in e&&"function"==typeof e.persist&&e.persist();let t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){let t=rI[e.key];if(t){let r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=t(this.config.keyboardDisplacement,i),r._keyboardActive=!0,rn.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in rI&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){let t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}let rO="undefined"!=typeof window&&window.document&&window.document.createElement;function rR(){return rO&&"ontouchstart"in window}let rD={isBrowser:rO,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:rR(),touchscreen:rR()||rO&&window.navigator.maxTouchPoints>1,pointer:rO&&"onpointerdown"in window,pointerLock:rO&&"exitPointerLock"in window.document},rF=10,rL={mouse:0,touch:0,pen:8},rV=ru(ru({},rC),{},{device(e,t,{pointer:{touch:r=!1,lock:i=!1,mouse:n=!1}={}}){return(this.pointerLock=i&&rD.pointerLock,rD.touch&&r)?"touch":this.pointerLock?"mouse":rD.pointer&&!n?"pointer":rD.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:r}){if(this.preventScrollDelay="number"==typeof r?r:r||void 0===r&&e?250:void 0,rD.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture(e,t,{pointer:{capture:r=!0,buttons:i=1,keys:n=!0}={}}){return this.pointerButtons=i,this.keys=n,!this.pointerLock&&"pointer"===this.device&&r},threshold(e,t,{filterTaps:r=!1,tapsThreshold:i=3,axis:n}){let a=rn.toVector(e,r?i:n?1:0);return this.filterTaps=r,this.tapsThreshold=i,a},swipe({velocity:e=.5,distance:t=50,duration:r=250}={}){return{velocity:this.transform(rn.toVector(e)),distance:this.transform(rn.toVector(t)),duration:r}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?ru(ru({},rL),e):rL,keyboardDisplacement:(e=rF)=>e});function rj(e){let[t,r]=e.overflow,[i,n]=e._delta,[a,s]=e._direction;(t<0&&i>0&&a<0||t>0&&i<0&&a>0)&&(e._movement[0]=e._movementBound[0]),(r<0&&n>0&&s<0||r>0&&n<0&&s>0)&&(e._movement[1]=e._movementBound[1])}class rz extends rE{constructor(...e){super(...e),ro(this,"ingKey","pinching"),ro(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:r}=this.state;"wheel"===e?this.state.offset=rn.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,r]=e._movement;if(!e.axis){let i=30*Math.abs(t)-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>r.has(e))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);let i=ry(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(e=>i.has(e))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let n=rg(...Array.from(r.values()));n&&this.pinchStart(e,n)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=ry(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let r=rg(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){let r=this.state,i=r._values[1],n=t.angle-i,a=0;Math.abs(n)>270&&(a+=Math.sign(n)),this.computeValues([t.distance,t.angle-360*a]),r.origin=t.origin,r.turns=a,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=rn.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||!e.cancelable||e.preventDefault();let t=this.state;t._delta=[-r_(e)[1]/100*t.offset[0],0],rn.addTo(t._movement,t._delta),rj(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}let rB=ru(ru({},rP),{},{device(e,t,{shared:r,pointer:{touch:i=!1}={}}){if(r.target&&!rD.touch&&rD.gesture)return"gesture";if(rD.touch&&i)return"touch";if(rD.touchscreen){if(rD.pointer)return"pointer";if(rD.touch)return"touch"}},bounds(e,t,{scaleBounds:r={},angleBounds:i={}}){let n=e=>{let t=rS(rx(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},a=e=>{let t=rS(rx(i,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof r&&"function"!=typeof i?[n(),a()]:e=>[n(e),a(e)]},threshold(e,t,r){return this.lockDirection="lock"===r.axis,rn.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});class rH extends rT{constructor(...e){super(...e),ro(this,"ingKey","moving")}move(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(rb(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;let t=rb(e),r=this.state;r._delta=rn.sub(t,r._values),rn.addTo(r._movement,r._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}}let rN=ru(ru({},rC),{},{mouseOnly:(e=!0)=>e});class rW extends rT{constructor(...e){super(...e),ro(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();let t=this.state,r=function(e){var t,r;let{scrollX:i,scrollY:n,scrollLeft:a,scrollTop:s}=e.currentTarget;return[null!==(t=null!=i?i:a)&&void 0!==t?t:0,null!==(r=null!=n?n:s)&&void 0!==r?r:0]}(e);t._delta=rn.sub(r,t._values),rn.addTo(t._movement,t._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}class r$ extends rT{constructor(...e){super(...e),ro(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=r_(e),rn.addTo(t._movement,t._delta),rj(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}class rq extends rT{constructor(...e){super(...e),ro(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(rb(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&"mouse"!==e.pointerType)return;let t=this.state;if(!t._active)return;t._active=!1;let r=rb(e);t._movement=t._delta=rn.sub(r,t._values),this.computeValues(r),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}}let rG=ru(ru({},rC),{},{mouseOnly:(e=!0)=>e}),rX=new Map,rY=new Map;function rK(e){rX.set(e.key,e.engine),rY.set(e.key,e.resolver)}let rZ={key:"drag",engine:rU,resolver:rV},rQ={key:"hover",engine:rq,resolver:rG},rJ={key:"move",engine:rH,resolver:rN},r0={key:"pinch",engine:rz,resolver:rB},r1={key:"scroll",engine:rW,resolver:rC},r2={key:"wheel",engine:r$,resolver:rC},r3={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=rD.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},r5=["target","eventOptions","window","enabled","transform"];function r4(e={},t){let r={};for(let[i,n]of Object.entries(t))switch(typeof n){case"function":r[i]=n.call(r,e[i],i,e);break;case"object":r[i]=r4(e[i],n);break;case"boolean":n&&(r[i]=e[i])}return r}class r6{constructor(e,t){ro(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,n){let a=this._listeners,s=function(e,t=""){let r=rc[e];return e+(r&&r[t]||t)}(t,r),o=ru(ru({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),n);e.addEventListener(s,i,o);let l=()=>{e.removeEventListener(s,i,o),a.delete(l)};return a.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class r8{constructor(){ro(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class r7{constructor(e){ro(this,"gestures",new Set),ro(this,"_targetEventStore",new r6(this)),ro(this,"gestureEventStores",{}),ro(this,"gestureTimeoutStores",{}),ro(this,"handlers",{}),ro(this,"config",{}),ro(this,"pointerIds",new Set),ro(this,"touchIds",new Set),ro(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),e.drag&&r9(this,"drag"),e.wheel&&r9(this,"wheel"),e.scroll&&r9(this,"scroll"),e.move&&r9(this,"move"),e.pinch&&r9(this,"pinch"),e.hover&&r9(this,"hover")}setEventIds(e){return rp(e)?(this.touchIds=new Set(Array.from(e.touches).filter(t=>{var r,i;return t.target===e.currentTarget||(null===(r=e.currentTarget)||void 0===r||null===(i=r.contains)||void 0===i?void 0:i.call(r,t.target))}).map(e=>e.identifier)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,r={}){let{target:i,eventOptions:n,window:a,enabled:s,transform:o}=e,l=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,r5);if(r.shared=r4({target:i,eventOptions:n,window:a,enabled:s,transform:o},r3),t){let e=rY.get(t);r[t]=r4(ru({shared:r.shared},l),e)}else for(let e in l){let t=rY.get(e);t&&(r[e]=r4(ru({shared:r.shared},l[e]),t))}return r}(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t;let r=this.config.shared,i={};if(!r.target||(t=r.target())){if(r.enabled){for(let r of this.gestures){let n=this.config[r],a=ie(i,n.eventOptions,!!t);n.enabled&&new(rX.get(r))(this,e,r).bind(a)}let n=ie(i,r.eventOptions,!!t);for(let t in this.nativeHandlers)n(t,"",r=>this.nativeHandlers[t](ru(ru({},this.state.shared),{},{event:r,args:e})),void 0,!0)}for(let e in i)i[e]=function(...e){return 0===e.length?rM:1===e.length?e[0]:function(){let t;for(let r of e)t=r.apply(this,arguments)||t;return t}}(...i[e]);if(!t)return i;for(let e in i){let{device:r,capture:n,passive:a}=function(e){let t=e.substring(2).toLowerCase(),r=!!~t.indexOf("passive");r&&(t=t.replace("passive",""));let i=rf.includes(t)?"capturecapture":"capture",n=!!~t.indexOf(i);return n&&(t=t.replace("capture","")),{device:t,capture:n,passive:r}}(e);this._targetEventStore.add(t,r,"",i[e],{capture:n,passive:a})}}}}function r9(e,t){e.gestures.add(t),e.gestureEventStores[t]=new r6(e,t),e.gestureTimeoutStores[t]=new r8}let ie=(e,t,r)=>(i,n,a,s={},o=!1)=>{var l,u;let c=null!==(l=s.capture)&&void 0!==l?l:t.capture,h=null!==(u=s.passive)&&void 0!==u?u:t.passive,d=o?i:function(e,t="",r=!1){let i=rc[e],n=i&&i[t]||t;return"on"+rh(e)+rh(n)+(!function(e=!1,t){return e&&!rd.includes(t)}(r,n)?"":"Capture")}(i,n,c);r&&h&&(d+="Passive"),e[d]=e[d]||[],e[d].push(a)},it=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function ir(e,t,r,i,n,a){if(!e.has(r)||!rX.has(i))return;let s=r+"Start",o=r+"End";n[i]=e=>{let i;return e.first&&s in t&&t[s](e),r in t&&(i=t[r](e)),e.last&&o in t&&t[o](e),i},a[i]=a[i]||{}}function ii({enabled:e=!0,snap:t,global:r,domElement:i,cursor:n=!0,children:a,speed:s=1,rotation:o=[0,0,0],zoom:l=1,polar:f=[0,Math.PI/2],azimuth:p=[-1/0,1/0],config:m={mass:1,tension:170,friction:26}}){var v,g;let y=(0,d.A)(e=>e.events),w=(0,d.A)(e=>e.gl),b=i||y.connected||w.domElement,{size:_}=(0,d.A)(),x=c.useMemo(()=>[o[0]+f[0],o[0]+f[1]],[o[0],f[0],f[1]]),M=c.useMemo(()=>[o[1]+p[0],o[1]+p[1]],[o[1],p[0],p[1]]),S=c.useMemo(()=>[h.MathUtils.clamp(o[0],...x),h.MathUtils.clamp(o[1],...M),o[2]],[o[0],o[1],o[2],x,M]),[E,T]=function(e,t){let r=O.fun(e),[[i],n]=function(e,t,r){let i=O.fun(t)&&t;i&&!r&&(r=[]);let n=(0,c.useMemo)(()=>i||3==arguments.length?t8():void 0,[]),a=(0,c.useRef)(0),s=eG(),o=(0,c.useMemo)(()=>({ctrls:[],queue:[],flush(e,t){let r=tJ(e,t);return!(a.current>0)||o.queue.length||Object.keys(r).some(t=>!e.springs[t])?new Promise(i=>{t0(e,r),o.queue.push(()=>{i(tZ(e,t))}),s()}):tZ(e,t)}}),[]),l=(0,c.useRef)([...o.ctrls]),u=[],h=eK(e)||0;function d(e,r){for(let n=e;n<r;n++){let e=l.current[n]||(l.current[n]=new tK(null,o.flush)),r=i?i(n,e):t[n];r&&(u[n]=function(e){let t=tN(e);return O.und(t.default)&&(t.default=th(t)),t}(r))}}(0,c.useMemo)(()=>{D(l.current.slice(e,h),e=>{var t;null==(t=e.ref)||t.delete(e),null==n||n.delete(e),e.stop(!0)}),l.current.length=e,d(h,e)},[e]),(0,c.useMemo)(()=>{d(0,Math.min(h,e))},r);let f=l.current.map((e,t)=>tJ(e,u[t])),p=(0,c.useContext)(t4),m=eK(p),v=p!==m&&function(e){for(let t in e)return!0;return!1}(p);e$(()=>{a.current++,o.ctrls=l.current;let{queue:e}=o;e.length&&(o.queue=[],D(e,e=>e())),D(l.current,(e,t)=>{null==n||n.add(e),v&&e.start({default:p});let r=u[t];r&&(function(e,t){if(t&&e.ref!==t){var r;null==(r=e.ref)||r.delete(e),t.add(e),e.ref=t}}(e,r.ref),e.ref?e.queue.push(r):e.start(r))})}),eX(()=>()=>{D(o.ctrls,e=>e.stop(!0))});let g=f.map(e=>ta({},e));return n?[g,n]:g}(1,r?e:[e],r?t||[]:t);return r||2==arguments.length?[i,n]:i}(()=>({scale:1,rotation:S,config:m}));c.useEffect(()=>void T.start({scale:1,rotation:S,config:m}),[S]),c.useEffect(()=>{if(r&&n&&e)return b.style.cursor="grab",w.domElement.style.cursor="",()=>{b.style.cursor="default",w.domElement.style.cursor="default"}},[r,n,b,e]);let A=(v={onHover:({last:t})=>{n&&!r&&e&&(b.style.cursor=t?"auto":"grab")},onDrag:({down:r,delta:[i,a],memo:[o,u]=E.rotation.animation.to||S})=>{if(!e)return[a,i];n&&(b.style.cursor=r?"grabbing":"grab"),i=h.MathUtils.clamp(u+i/_.width*Math.PI*s,...M),a=h.MathUtils.clamp(o+a/_.height*Math.PI*s,...x);let c=t&&!r&&"boolean"!=typeof t?t:m;return T.start({scale:r&&a>x[1]/2?l:1,rotation:t&&!r?S:[a,i,0],config:e=>"scale"===e?{...c,friction:3*c.friction}:c}),[a,i]}},g={target:r?b:void 0},([rZ,r0,r1,r2,rJ,rQ].forEach(rK),function(e,t){let{handlers:r,nativeHandlers:i,config:n}=function(e,t){let[r,i,n]=function(e){let t={},r={},i=new Set;for(let n in e)it.test(n)?(i.add(RegExp.lastMatch),r[n]=e[n]):t[n]=e[n];return[r,t,i]}(e),a={};return ir(n,r,"onDrag","drag",a,t),ir(n,r,"onWheel","wheel",a,t),ir(n,r,"onScroll","scroll",a,t),ir(n,r,"onPinch","pinch",a,t),ir(n,r,"onMove","move",a,t),ir(n,r,"onHover","hover",a,t),{handlers:a,config:t,nativeHandlers:i}}(e,t||{});return function(e,t={},r,i){let n=c.useMemo(()=>new r7(e),[]);if(n.applyHandlers(e,i),n.applyConfig(t,r),c.useEffect(n.effect.bind(n)),c.useEffect(()=>n.clean.bind(n),[]),void 0===t.target)return n.bind.bind(n)}(r,n,void 0,i)})(v,g||{}));return c.createElement(ri.group,(0,u.Z)({},null==A?void 0:A(),E),a)}}}]);